<p><span style="font-size:14px;"><strong><span style="color:rgb(255,0,0);">一、简介</span></strong></span><span style="font-size:12px;"><br></span></p>
<p><span style="font-size:12px;"><strong><span style="border-collapse:separate;color:rgb(0,0,0);font-family:Tahoma;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;font-size:14px;">Dubbo</span></strong><span style="border-collapse:separate;color:rgb(0,0,0);font-family:Tahoma;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;font-size:14px;">是Alibaba开源的分布式服务框架，它最大的特点是按照分层的方式来架构，使用这种方式可以使各个层之间解耦合（或者最大限度地 松耦合）。从服务模型的角度来看，Dubbo采用的是一种非常简单的模型，要么是提供方提供服务，要么是消费方消费服务，所以基于这一点可以抽象出服务提 供方（Provider）和服务消费方（Consumer）两个角色。关于注册中心、协议支持、服务监控等内容。</span></span></p>
<p><span style="font-size:12px;">主要核心部件：<br><br>&nbsp;&nbsp; &nbsp;* Remoting: 网络通信框架，实现了 sync-over-async 和 request-response 消息机制.<br><br>&nbsp;&nbsp; &nbsp;* RPC: 一个远程过程调用的抽象，支持负载均衡、容灾和集群功能<br><br>&nbsp;&nbsp; &nbsp;* Registry: 服务目录框架用于服务的注册和服务事件发布和订阅<br><br>Dubbo工作原理<br>&nbsp;&nbsp; &nbsp;* Provider<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;* 暴露服务方称之为“服务提供者”。<br>&nbsp;&nbsp; &nbsp;* Consumer<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;* 调用远程服务方称之为“服务消费者”。<br>&nbsp;&nbsp; &nbsp;* Registry（使用zookeeper）<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;* 服务注册与发现的中心目录服务称之为“服务注册中心”。<br>&nbsp;&nbsp; &nbsp;* Monitor<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;* 统计服务的调用次调和调用时间的日志服务称之为“服务监控中心”。</span></p>
<p><span style="font-size:12px;"><br></span></p>
<p><span style="color:rgb(255,0,0);font-size:12px;"><strong><span style="color:rgb(255,0,0);font-size:14px;">二、PROVIDER安装部署</span></strong><br><span style="font-size:12px;color:rgb(0,0,0);">1.JDK安装<br>&nbsp; 1.1 检查和卸载自带jdk<br>&nbsp;&nbsp; &nbsp;[root@zck ~]# java -version<br>&nbsp;&nbsp; &nbsp;java version "1.6.0_24"<br>&nbsp;&nbsp; &nbsp;[root@zck ~]# rpm -qa | grep java<br>&nbsp;&nbsp; &nbsp;[root@zck ~]# rpm -e --nodeps tzdata-java-2013g-1.el6.noarch<br>&nbsp;&nbsp; &nbsp;[root@zck ~]# rpm -e --nodeps java-1.6.0-openjdk-1.6.0.0-1.66.1.13.0.el6.x86_64<br>&nbsp;&nbsp; &nbsp;[root@zck ~]# rpm -e --nodeps java-1.7.0-openjdk-1.7.0.45-2.4.3.3.el6.x86_64<br><br>&nbsp;&nbsp; &nbsp;1.2 安装jdk1.7<br>&nbsp;&nbsp; &nbsp;上传jdk<br>&nbsp;&nbsp; &nbsp; tar -zxvf jdk-7u55-linux-x64.tar.gz<br>&nbsp;&nbsp; &nbsp;cp -R jdk1.7.0_55 /usr/java<br>&nbsp;&nbsp; &nbsp;# vim /etc/profile<br>&nbsp;&nbsp; &nbsp;修改/etc/profile 最后面加入<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;export JAVA_HOME=/usr/java<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;export PATH=$PATH:$JAVA_HOME/bin<br>&nbsp;&nbsp;&nbsp; &nbsp;保存退出。运行 #source /etc/profile<br>&nbsp;&nbsp; &nbsp;# update-alternatives --install /usr/bin/java java /usr/java/jdk1.7.0_55/bin/java 60<br>&nbsp;&nbsp; &nbsp;# update-alternatives --config java<br>&nbsp;&nbsp; &nbsp;# java -version<br><br>2.TOMCAT安装<br>&nbsp;&nbsp; &nbsp;2.1 下载&amp;安装<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/apache-tomcat-7.0.57.tar.gz<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tar -xzvf apache-tomcat-7.0.57.tar.gz<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#将解压缩后的文件夹拷贝到 /opt/tomcat7:<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cp -R apache-tomcat-7.0.57&nbsp; /opt/tomcat7<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#添加专用OS用户<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;useradd -s /sbin/nologin tomcat <br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;chown -R tomcat:tomcat /opt/tomcat7 <br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#进入tomcat目录设置tomcat 的内存使用情况及其他配置：<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cd&nbsp; /opt/tomcat7/bin<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;vi daemon.sh<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#在正文开始的地方加入以下内容(内存等要结合硬件调优)【此脚本可以直接上传 】<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# chkconfig: 2345 20 80<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# description: simple example to start tomcat<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;JAVA_HOME=/usr/java<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;CATALINA_HOME=/opt/tomcat7<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;CATALINA_OPTS="-Xms1024m -Xmx4096m -XX:PermSize=256m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/log/tomcat"<br><br>&nbsp;&nbsp; &nbsp;2.2 设置成自启动服务<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;wget http://mirror.bit.edu.cn/apache//commons/daemon/source/commons-daemon-1.0.15-src.tar.gz <br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tar -zxvf commons-daemon-1.0.15-src.tar.gz<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cd commons-daemon-1.0.15-src/src/native/unix<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;./configure<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;make<br>&nbsp;&nbsp; &nbsp;&nbsp; #复制jsvc到/opt/tomcat7/bin目录下面 <br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cp jsvc /opt/tomcat7/bin<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cp jsvc /etc/bin<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cd /opt/tomcat7/bin<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cp daemon.sh&nbsp; /etc/init.d/tomcat<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;chmod 755&nbsp; /etc/init.d/tomcat<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;chkconfig --add tomcat<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;chkconfig tomcat on<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;chkconfig --list tomcat<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;显示： <br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tomcat 0:off 1:off 2:on 3:on 4:on 5:on 6:off　 ← 确认2~5为on的状态就OK<br><br>&nbsp;&nbsp; &nbsp;2.3 启动tomcat<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service tomcat start<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#增加防火墙配置，允许8080端口【暂时不开启防火墙】：<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;vi /etc/sysconfig/iptables<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#在允许ssh的下面增加一条(只面向Web服务器开放权限!!!)：<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;iptables -A INPUT -p tcp -s 192.168.1.1 --dport 8080 -j ACCEPT<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/etc/rc.d/init.d/iptables save<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service iptables restart<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;iptables -L -n<br>&nbsp;&nbsp; &nbsp;2.4 查看tomcat进程<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ps aux | grep tomcat <br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br><span style="font-size:14px;color:rgb(255,0,0);"><strong>三、ZK+DUBBO安装</strong></span><br>TOMCAT参见上方<br><br>3.ZOOKEEPER安装【伪集群】<br>&nbsp;&nbsp; &nbsp;3.1 下载安装<br>&nbsp;&nbsp; &nbsp;wget http://mirrors.cnnic.cn/apache/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz<br>&nbsp;&nbsp; &nbsp;tar xzvf zookeeper-3.4.6.tar.gz<br>&nbsp;&nbsp; &nbsp;cp -R zookeeper-3.4.6 /zookeeper/server1<br>&nbsp;&nbsp; &nbsp;cp -R zookeeper-3.4.6 /zookeeper/server2<br>&nbsp;&nbsp; &nbsp;cp -R zookeeper-3.4.6 /zookeeper/server3<br>&nbsp;&nbsp; &nbsp;#建立data和log目录<br>&nbsp;&nbsp; &nbsp;mkdir -p /zookeeper/server1/data<br>&nbsp;&nbsp; &nbsp;mkdir -p /zookeeper/server1/logs<br>&nbsp;&nbsp; &nbsp;mkdir -p /zookeeper/server2/data<br>&nbsp;&nbsp; &nbsp;mkdir -p /zookeeper/server2/logs<br>&nbsp;&nbsp; &nbsp;mkdir -p /zookeeper/server3/data<br>&nbsp;&nbsp; &nbsp;mkdir -p /zookeeper/server3/logs<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;3.2 配置<br>&nbsp;&nbsp; &nbsp;#那么首先进入【data】目录，创建一个myid的文件，里面写入一个数字，比如我这个是server1,那么就写一个1，server2对应myid文件就写入2，server3对应myid文件就写个3<br>&nbsp;&nbsp; &nbsp;echo 1 &gt;myid<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;cd /zookeeper/server1/conf<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;cp zoo_sample.cfg zoo.cfg<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;mv zoo_sample.cfg zoo_sample.cfg.bak<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;vi zoo.cfg<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# The number of milliseconds of each tick<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tickTime=2000<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# The number of ticks that the initial<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# synchronization phase can take<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;initLimit=10<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# The number of ticks that can pass between<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# sending a request and getting an acknowledgement<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;syncLimit=5<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# the directory where the snapshot is stored.<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# do not use /tmp for storage, /tmp here is just<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# example sakes.<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#注意修改<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dataDir=/zookeeper/server1/data<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dataLogDir=/zookeeper/server1/logs<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# the port at which the clients will connect<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;clientPort=2181<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# Be sure to read the maintenance section of the<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# administrator guide before turning on autopurge.<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# The number of snapshots to retain in dataDir<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#autopurge.snapRetainCount=3<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# Purge task interval in hours<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# Set to "0" to disable auto purge feature<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#autopurge.purgeInterval=1<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#在文件末尾添加如下内容：<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;server.1=127.0.0.1:2888:3888<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;server.2=127.0.0.1:2889:3889<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;server.3=127.0.0.1:2890:3890<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#需要注意的是clientPort这个端口如果你是在1台机器上部署多个server,那么每台机器都要不同的clientPort，<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;比如我server1是2181,server2是2182，server3是2183，dataDir和dataLogDir也需要区分下。<br><br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#最后几行唯一需要注意的地方就是 server.X 这个数字就是对应 data/myid中的数字。你在3个server的myid文件中分别写入了1，2，3，<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;那么每个server中的zoo.cfg都配server.1,server.2,server.3就OK了。因为在同一台机器上，后面连着的2个端口3个server都不要一样，<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;否则端口冲突，其中第一个端口用来集群成员的信息交换，第二个端口是在leader挂掉时专门用来进行选举leader所用。<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;server2和server3配置参见server1<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;3.3 启动<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#分别进入三个服务器的zookeeper-3.4.3/bin目录下，启动服务<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; ./zkServer.sh start <br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; /zookeeper/server1/bin/zkServer.sh start<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; /zookeeper/server2/bin/zkServer.sh start<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; /zookeeper/server3/bin/zkServer.sh start<br><br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#启动完成后，查看服务器状态<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;./zkServer.sh status<br><br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;3.4接入客户端<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;#进入任意一个服务器的zookeeper/bin目录下，启动一个客户端，接入服务。<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;./zkCli.sh &#xfffd;server localhost:3181 <br><br>4.DUBBOADMIN配置<br>&nbsp;&nbsp; &nbsp;cp dubbo-admin-2.8.4-SNAPSHOT.war /opt/tomcat7/webapps<br>&nbsp;&nbsp; &nbsp;service tomcat stop<br>&nbsp;&nbsp; &nbsp;service tomcat start<br>&nbsp;&nbsp; &nbsp;cd /opt/tomcat7/webapps<br>&nbsp;&nbsp; &nbsp;mv dubbo-admin-2.8.4-SNAPSHOT dubbo<br>&nbsp;&nbsp; &nbsp;service tomcat stop<br>&nbsp;&nbsp; &nbsp;service tomcat start<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;访问dubbo后台： http://localhost:8080/dubbo 默认用户名/密码：root/root</span><br><br><br><br></span></p>
