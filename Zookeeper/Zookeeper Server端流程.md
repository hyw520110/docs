<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">1.</span><span style="font-size:13px;font-family:'宋体';">当</span><span style="font-size:13px;font-family:consolas;">ServerConnectionFactory</span><span style="font-size:13px;font-family:'宋体';">接到一个连接请求，首先创建一个</span><span style="font-size:13px;font-family:consolas;">ServerConn</span><span style="font-size:13px;font-family:'宋体';">，然后将其加入到</span><span style="font-size:13px;font-family:consolas;">ConnList</span><span style="font-size:13px;font-family:'宋体';">以及一个</span><span style="font-size:13px;font-family:consolas;">ipmap(</span><span style="font-size:13px;font-family:'宋体';">保存的是每个客户端对应的连接</span><span style="font-size:13px;font-family:consolas;">)</span></p>
<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">2.</span><span style="font-size:13px;font-family:'宋体';">接下来</span><span style="font-size:13px;font-family:consolas;">ServerConnectionFactory</span><span style="font-size:13px;font-family:'宋体';">每秒检查一次客户端的消息，对接收到的消息进行一次混排之后处理</span></p>
<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">3.</span><span style="font-size:13px;font-family:'宋体';">这里以读为例：对于读请求，由</span><span style="font-size:13px;font-family:consolas;">ServerConn</span><span style="font-size:13px;font-family:'宋体';">进行数据读取，并将数据提交到</span><span style="font-size:13px;font-family:consolas;">ZookeeperServer</span></p>
<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">4.</span><span style="font-size:13px;font-family:consolas;">ZKServer</span><span style="font-size:13px;font-family:'宋体';">将</span><span style="font-size:13px;font-family:consolas;">Session</span><span style="font-size:13px;font-family:'宋体';">加入到</span><span style="font-size:13px;font-family:consolas;">SessionTracker</span><span style="font-size:13px;font-family:'宋体';">后，把拿到的数据封装为</span><span style="font-size:13px;font-family:consolas;">Request</span><span style="font-size:13px;font-family:'宋体';">对象提交到</span><span style="font-size:13px;font-family:consolas;">RequestProcessor chain</span><span style="font-size:13px;font-family:'宋体';">进行处理</span></p>
<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">5.</span><span style="font-size:13px;font-family:'宋体';">最后到</span><span style="font-size:13px;font-family:consolas;">FinalProcessor</span><span style="font-size:13px;font-family:'宋体';">生成</span><span style="font-size:13px;font-family:consolas;">Response</span><span style="font-size:13px;font-family:'宋体';">有</span><span style="font-size:13px;font-family:consolas;">ServerConn</span><span style="font-size:13px;font-family:'宋体';">写回</span></p>
<p><a href="http://img1.51cto.com/attachment/201310/020454690.png" target="_blank"><img onload="if(this.width>650) this.width=650;" src="http://img1.51cto.com/attachment/201310/020454690.png" title="zk server pro.png" alt="020454690.png"></a></p>
<p>本文出自 “<a href="http://boylook.blog.51cto.com">MIKE老毕的海贼船</a>” 博客，请务必保留此出处<a href="http://boylook.blog.51cto.com/7934327/1314168">http://boylook.blog.51cto.com/7934327/1314168</a></p>
