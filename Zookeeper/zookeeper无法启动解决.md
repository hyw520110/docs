<p>今日为了释放空间，kill了zookeeper进程，没想到kill了后就启动不起来了</p>
<p>提示已正常启动</p>
<p><span style="font-size:14px;"><em>[root@lnx-a-11 bin]# ./zkServer.sh start<br>JMX enabled by default<br>Using config: /home/tester/zookeeper/bin/../conf/zoo.cfg<br>Starting zookeeper ... STARTED<br>[root@lnx-air-9-27 bin]# ps aux |grep zook</em></span></p>
<p>但看后台进程没有</p>
<p>查看<span style="color:rgb(0,176,240);">zookeeper.out</span>日志，有如下提示：</p>
<p><span style="font-size:14px;"><em>2015-12-31 17:32:04,090 [myid:] - ERROR [main:QuorumPeerMain@85] - Invalid config, exiting abnormally<br>org.apache.zookeeper.server.quorum.QuorumPeerConfig$ConfigException: Error processing /home/tester/zookeeper/bin/../conf/zoo.cfg<br>&nbsp;&nbsp; &nbsp;at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parse(QuorumPeerConfig.java:123)<br>&nbsp;&nbsp; &nbsp;at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:101)<br>&nbsp;&nbsp; &nbsp;at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78)<br>Caused by: java.lang.IllegalArgumentException: /tmp/zookeeper/data/myid file is missing<br>&nbsp;&nbsp; &nbsp;at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parseProperties(QuorumPeerConfig.java:350)<br>&nbsp;&nbsp; &nbsp;at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parse(QuorumPeerConfig.java:119)</em></span></p>
<p><br></p>
<p>提示很明显<span style="color:rgb(0,176,240);">/tmp/zookeeper/data/myid file is missing</span></p>
<p><span style="color:rgb(0,0,0);">到该目录下发现确实没有myid这个文件，大家知道/tmp文件夹是一个临时目录，里面的文件很可能过一段时间就会被删除</span></p>
<p><span style="color:rgb(0,0,0);">查看</span><span style="color:rgb(0,176,240);">/etc/cron.daily/tmpwatch</span><span style="color:rgb(0,0,0);">文件，显示如下内容</span></p>
<p><span style="font-size:14px;"><em><span style="color:rgb(0,0,0);">#! /bin/sh<br>flags=-umc<br>/usr/sbin/tmpwatch "$flags" -x /tmp/.X11-unix -x /tmp/.XIM-unix \<br>&nbsp;&nbsp; &nbsp;-x /tmp/.font-unix -x /tmp/.ICE-unix -x /tmp/.Test-unix \<br>&nbsp;&nbsp; &nbsp;-X '/tmp/hsperfdata_*' 10d /tmp<br>/usr/sbin/tmpwatch "$flags" 30d /var/tmp<br>for d in /var/{cache/man,catman}/{cat?,X11R6/cat?,local/cat?}; do<br>&nbsp;&nbsp;&nbsp; if [ -d "$d" ]; then<br>&nbsp;&nbsp; &nbsp;/usr/sbin/tmpwatch "$flags" -f 30d "$d"<br>&nbsp;&nbsp;&nbsp; fi<br>done</span></em></span></p>
<p><br><span style="color:rgb(0,0,0);"></span></p>
<p><span style="color:rgb(0,0,0);">可以知道/tmp文件中的内容除了设定的文件将会10d清除一次</span></p>
<p><span style="color:rgb(0,0,0);">所以我们不应该把myid放在/tmp下或者要把这个文件从清除文件中排除出去</span></p>
<p><br><span style="color:rgb(0,0,0);"></span></p>
<p><span style="color:rgb(0,0,0);">添加myid文件，修改zoo.cfg中的data目录后，再次启动，启动成功</span></p>
<p><span style="color:rgb(0,0,0);">[root@lnx-a-11 bin]# ps aux |grep zook<br><span style="color:rgb(0,0,0);font-size:14px;"><em>root&nbsp;&nbsp;&nbsp;&nbsp; 21869 24.7&nbsp; 0.8 2584892 35100 pts/2&nbsp;&nbsp; Sl&nbsp;&nbsp; 17:54&nbsp;&nbsp; 0:01 java -Dzookeeper.log.dir=/home/tester/zookeeper/bin/../logs -Dzookeeper.root.logger=INFO,CONSOLE -cp /home/tester/zookeeper/bin/../build/classes:/home/tester/zookeeper/bin/../build/lib/*.jar:/home/tester/zookeeper/bin/../lib/slf4j-log4j12-1.6.1.jar:/home/tester/zookeeper/bin/../lib/slf4j-api-1.6.1.jar:/home/tester/zookeeper/bin/../lib/netty-3.7.0.Final.jar:/home/tester/zookeeper/bin/../lib/log4j-1.2.16.jar:/home/tester/zookeeper/bin/../lib/jline-0.9.94.jar:/home/tester/zookeeper/bin/../zookeeper-3.4.6.jar:/home/tester/zookeeper/bin/../src/java/lib/*.jar:/home/tester/zookeeper/bin/../conf: -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=false org.apache.zookeeper.server.quorum.QuorumPeerMain /home/tester/zookeeper/bin/../conf/zoo.cfg<br>root&nbsp;&nbsp;&nbsp;&nbsp; 21948&nbsp; 0.0&nbsp; 0.0 103252&nbsp;&nbsp; 808 pts/2&nbsp;&nbsp;&nbsp; D+&nbsp;&nbsp; 17:55&nbsp;&nbsp; 0:00 grep zook</em></span></span></p>
<div id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd"></div>
