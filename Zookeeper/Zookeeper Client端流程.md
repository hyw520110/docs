<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">1.</span><span style="font-size:13px;font-family:consolas;">ClientConn</span><span style="font-size:13px;font-family:'宋体';">封装</span><span style="font-size:13px;font-family:consolas;">RequstHeader</span><span style="font-size:13px;font-family:'宋体';">，</span><span style="font-size:13px;font-family:consolas;">Request</span><span style="font-size:13px;font-family:'宋体';">并提交到</span><span style="font-size:13px;font-family:consolas;">outgoing Queue</span><span style="font-size:13px;font-family:'宋体';">，阻塞等待</span></p>
<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">2.</span><span style="font-size:13px;font-family:consolas;">SendThread</span><span style="font-size:13px;font-family:'宋体';">唤醒</span><span style="font-size:13px;font-family:consolas;">ClientConnSocket</span><span style="font-size:13px;font-family:'宋体';">，由其从</span><span style="font-size:13px;font-family:consolas;">outgoing queue</span><span style="font-size:13px;font-family:'宋体';">取请求并进行数据传输，包括</span><span style="font-size:13px;font-family:consolas;">Xid</span><span style="font-size:13px;font-family:'宋体';">的分配也是在这里进行；并将</span><span style="font-size:13px;font-family:consolas;">Packet</span><span style="font-size:13px;font-family:'宋体';">加入</span><span style="font-size:13px;font-family:consolas;">pending queue</span></p>
<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">3.</span><span style="font-size:13px;font-family:'宋体';">当</span><span style="font-size:13px;font-family:consolas;">ClientConnSocket</span><span style="font-size:13px;font-family:'宋体';">接收到消息时，调用</span><span style="font-size:13px;font-family:consolas;">SendThread</span><span style="font-size:13px;font-family:'宋体';">进行读请求处理，构建</span><span style="font-size:13px;font-family:consolas;">ReplyHeader</span><span style="font-size:13px;font-family:'宋体';">并调用</span><span style="font-size:13px;font-family:consolas;">EventThread</span><span style="font-size:13px;font-family:'宋体';">将</span><span style="font-size:13px;font-family:consolas;">WatchEvent</span><span style="font-size:13px;font-family:'宋体';">（如果设定的话）加入</span><span style="font-size:13px;font-family:consolas;">waitingEvent</span><span style="font-size:13px;font-family:'宋体';">列表</span></p>
<p style="margin-left:24px;"><span style="font-size:13px;font-family:consolas;">4.</span><span style="font-size:13px;font-family:consolas;">EventThread</span><span style="font-size:13px;font-family:'宋体';">异步检查</span><span style="font-size:13px;font-family:consolas;">waitingEvent</span><span style="font-size:13px;font-family:'宋体';">，发现后调用</span><span style="font-size:13px;font-family:consolas;">Watcher</span><span style="font-size:13px;font-family:'宋体';">的</span><span style="font-size:13px;font-family:consolas;">process</span><span style="font-size:13px;font-family:'宋体';">流程，由</span><span style="font-size:13px;font-family:consolas;">watcher</span><span style="font-size:13px;font-family:'宋体';">具体实现</span></p>
<p><a href="http://img1.51cto.com/attachment/201310/020539338.png" target="_blank"><img onload="if(this.width>650) this.width=650;" src="http://img1.51cto.com/attachment/201310/020539338.png" title="zk connect process.png" alt="020539338.png"></a></p>
<p>本文出自 “<a href="http://boylook.blog.51cto.com">MIKE老毕的海贼船</a>” 博客，请务必保留此出处<a href="http://boylook.blog.51cto.com/7934327/1314170">http://boylook.blog.51cto.com/7934327/1314170</a></p>
