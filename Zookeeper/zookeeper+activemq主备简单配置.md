<p><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp;硬件环境：</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp;三台linux服务器：192.168.2.13,192.168.2.15,192.168.2.16。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp;推荐部署在三台机器上，都部署在一台机器还是会有单点故障，最少1G的内存就够了。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">下载最新版本的zookeeper，apache-activemq(都是linux的64位，jdk什么的就不说了)</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">下面的配置三台机器基本都是一样，特别之处有备注，下面开始搭建。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">1.新建文件夹 mqzk （可自己定义）</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">2.解压zookeeper，activmq到此目录。这里路径为：~/mqzk/zookeeper, ~/mqzk/activmq</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">3.配置zookeeper</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; 3.1 配置conf/zoo.cfg(zoo.cfg默认不存在的，需要把zoo_sample.cfg文件名称修改为zoo.cfg)</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 打开zoo.cfg，修改dataDir=当前zookeeper的data文件夹目录（如果没有data文件夹，就创建一个）</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 这里有三台zookeeper所以这里要配置下集群server，在zoo.cfg最后面添加三行：</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; server.1=192.168.2.13:2888:3888 (本机ip)</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; server.2=192.168.2.15:2888:3888 (第二台机ip)</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; server.3=192.168.2.16:2888:3888 (第三台机ip)</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 这里的三个server，对应着3台linux服务器（ok）。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;保存退出。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; 3.2 进入 ~/mqzk/zookeeper/data文件夹，新建myid文件。打开myid文件，里面输入1保存退出。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;输入1的原因是因为上面的server.1，所以这个值在3台zookeeper里是不一样的。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; 3.3 到此配置结束。其他两台按照此配置就可以了。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; 3.4 假设三台都配置好了，开始依次重启这3台服务器：进入zookeeper/bin目录，执行./zkServer.sh start 启动</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">4.配置activemq</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp;&nbsp;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp;4.1 这里主要是配置activemq/confg目录下的activemq.xml文件,打开activemq.xml文件。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;找到 &nbsp;&lt;broker xmlns="http://activemq.apache.org/schema/core" brokerName="panguixiangbroker" dataDirectory="${activemq.data}"&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 将 brokerName的值改为自己需要的字符串（我这里是panguixiangbroker）；</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;要特别注意这里，这个brokerName的值必须三台activemq一样（这样zookeeper才会认为是一个集群的）</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp;4.2 找到：</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;persistenceAdapter&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;kahaDB directory="${activemq.data}/kahadb"/&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/persistenceAdapter&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;改为：</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;persistenceAdapter&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;replicatedLevelDB</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directory="${activemq.data}/leveldb"</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;replicas="3" &nbsp; &lt;!--这里有三台所以就3了--&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bind="tcp://0.0.0.0:0"</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;zkAddress="192.168.2.13:2181,192.168.2.15:2181,192.168.2.16:2181"</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hostname="192.168.2.13" &nbsp; &nbsp;&lt;!--当前机器的ip--&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;zkPath="/activemq/leveldb-stores" sync="local_disk"/&gt; &nbsp; &lt;!--这个是默认的不用改--&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!--&lt;kahaDB directory="${activemq.data}/kahadb"/&gt; --&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/persistenceAdapter&gt;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;保存退出</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp;其他两台active mq的配置类似。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; &nbsp;依次启动3台 activemq。（bin/linux-64/./activemq start）</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">在浏览器访问:http://192.168.2.13:8161，http://192.168.2.15:8161，http://192.168.2.16:8161&nbsp;</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">&nbsp; 发现只有一台可以正常访问，这就对了。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">然后在spring的jms配置文件里，引用集群mq，例如：&nbsp;failover:(tcp://192.168.2.13:61616,&nbsp;tcp://192.168.2.15:61616 ,&nbsp;tcp://192.168.2.16:61616&nbsp;)&nbsp;。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">到此全部结束，当然这只是个简单的配置，更多配置参数请参考：</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">http://activemq.apache.org/replicated-leveldb-store.html</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">zookeeper有也有对外的api（java，ruby，python，php，等版本），可以根据业务需要开发适合直接的监控管理系统。</span><br style="padding:0px;margin:0px;color:rgb(57,57,57);font-family:'Times New Roman';white-space:normal;background-color:rgb(255,255,255);"><span style="color:rgb(57,57,57);font-family:'Times New Roman';background-color:rgb(255,255,255);">不在本文范围之类。</span></p>
<p>本文出自 “<a href="http://3131854.blog.51cto.com">重新来学JAVA</a>” 博客，请务必保留此出处<a href="http://3131854.blog.51cto.com/3121854/1676745">http://3131854.blog.51cto.com/3121854/1676745</a></p>
