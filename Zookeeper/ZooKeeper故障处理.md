<p><span style="font-family:'宋体';font-size:21px;font-weight:bold;">Zookeeper</span><span style="font-family:'宋体';font-size:21px;font-weight:bold;">一般会出现以下两种故障：</span><br></p>
<p><span style="font-family:'宋体';font-size:14px;">1.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">Zookeeper<span style="font-family:'宋体';">进程挂掉；</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">2.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">Zookeeper<span style="font-family:'宋体';">进程还在，但不提供服务；（提示：</span><span style="font-family:'Times New Roman';">This&nbsp;ZooKeeper&nbsp;instance&nbsp;is&nbsp;not&nbsp;currently&nbsp;serving&nbsp;requests</span><span style="font-family:'宋体';">）</span></span></p>
<p><span style="font-family:'宋体';font-weight:bold;font-size:21px;">Zookeeper<span style="font-family:'宋体';">故障监控：</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">1.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">针对<span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">进程的监控，直接监控器进程是否存在即可；（</span><span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">进程名字：</span><span style="font-family:'Times New Roman';">QuorumPeerMain</span><span style="font-family:'宋体';">）</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">2.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">针对<span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">不能提供服务，需要通过</span><span style="font-family:'Times New Roman';">linux&nbsp;shell</span><span style="font-family:'宋体';">命令监控；</span></span></p>
<p><span style="font-family:'宋体';font-weight:bold;font-size:14px;">当在<span style="font-family:'Times New Roman';">linux</span><span style="font-family:'宋体';">下输入以下命令并得到下面的结果时，说明</span><span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">还活着，但不提供服务了。（这种情况几率大）</span></span></p>
<p><span style="font-family:'宋体';font-weight:bold;font-size:14px;">&nbsp;&nbsp;&nbsp;[root@192.168.1.1&nbsp;bin]#&nbsp;</span><span style="font-family:'宋体';color:rgb(0,0,255);font-weight:bold;font-size:14px;">echo&nbsp;stat&nbsp;|&nbsp;nc&nbsp;localhost&nbsp;2181</span></p>
<p><span style="font-family:'宋体';font-weight:bold;font-size:14px;">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'宋体';color:rgb(255,0,0);font-weight:bold;font-size:14px;">This&nbsp;ZooKeeper&nbsp;instance&nbsp;is&nbsp;not&nbsp;currently&nbsp;serving&nbsp;requests</span></p>
<p><span style="font-family:'宋体';font-size:14px;">当在<span style="font-family:'Times New Roman';">linux</span><span style="font-family:'宋体';">下输入以下命令并得到下面的结果时，说明</span><span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">服务正常。</span></span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';font-weight:bold;font-size:14px;">[root@192.168.1.1&nbsp;bin]#&nbsp;</span><span style="font-family:'宋体';color:rgb(0,0,255);font-weight:bold;font-size:14px;">echo&nbsp;stat&nbsp;|&nbsp;nc&nbsp;localhost&nbsp;2181</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Zookeeper&nbsp;version:&nbsp;3.4.6-1569965,&nbsp;built&nbsp;on&nbsp;02/20/2014&nbsp;09:09&nbsp;GMT</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Clients:</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">&nbsp;/192.168.1.12:29432[1](queued=0,recved=13,sent=13)</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">&nbsp;/127.0.0.1:43448[0](queued=0,recved=1,sent=0)</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">&nbsp;</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Latency&nbsp;min/avg/max:&nbsp;0/1/11</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Received:&nbsp;235</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Sent:&nbsp;17</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Connections:&nbsp;2</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Outstanding:&nbsp;0</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Zxid:&nbsp;0x100000004</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Mode:&nbsp;leader</span></p>
<p style="text-indent:28px;text-align:justify;"><span style="font-family:'宋体';color:rgb(0,176,80);font-weight:bold;font-size:14px;">Node&nbsp;count:&nbsp;4</span></p>
<p style="text-align:justify;"><span style="font-family:'宋体';font-weight:bold;font-size:21px;">Zookeeper<span style="font-family:'宋体';">故障处理：</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">1.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">当<span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">出现以上两种故障或未知故障时，请先尝试重启</span><span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">；</span></span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-size:14px;">（启动命令：<span style="font-family:'Times New Roman';">/usr/zookeeper-3.4.6/bin/&nbsp;</span><span style="font-family:'宋体';">目录下执行&nbsp;</span><span style="font-family:'Times New Roman';">./zkServer.sh&nbsp;start&nbsp;</span><span style="font-family:'宋体';">）</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">2.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">重启之后首先要输入命令</span><span style="font-family:'宋体';color:rgb(0,0,255);font-weight:bold;font-size:14px;">jps</span><span style="font-family:'宋体';font-size:14px;">，看<span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">进程（</span><span style="font-family:'Times New Roman';">QuorumPeerMain</span><span style="font-family:'宋体';">）是否起来；</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">3.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">如果<span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">进程起来，再输入命令</span></span><span style="font-family:'宋体';color:rgb(0,0,255);font-weight:bold;font-size:14px;">echo&nbsp;stat&nbsp;|&nbsp;nc&nbsp;localhost&nbsp;2181</span><span style="font-family:'宋体';font-size:14px;">，看服务是否正常（如果数据量大可能需要等几分钟才能显示正确）；</span></p>
<p><span style="font-family:'宋体';font-size:14px;">4.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">如果第<span style="font-family:'Times New Roman';">2</span><span style="font-family:'宋体';">步的进程没有起来，或者第</span><span style="font-family:'Times New Roman';">3</span><span style="font-family:'宋体';">步的显示不能提供服务，则需要清除以下数据后再试</span><span style="font-family:'Times New Roman';">1</span><span style="font-family:'宋体';">、</span><span style="font-family:'Times New Roman';">2</span><span style="font-family:'宋体';">、</span><span style="font-family:'Times New Roman';">3</span><span style="font-family:'宋体';">步；</span></span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-size:14px;">需要清除下面两个文件夹下的所有数据（最好将数据备份到别的地方或重命名文件夹名字）：</span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-weight:bold;font-size:14px;">/var/zookeeper/data/version-2</span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-weight:bold;font-size:14px;">/var/zookeeper/logs/version-2</span></p>
<p><span style="font-family:'宋体';font-size:14px;">5.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">如果不幸走到了这一步，则意味着第<span style="font-family:'Times New Roman';">4</span><span style="font-family:'宋体';">步重试后第</span><span style="font-family:'Times New Roman';">2</span><span style="font-family:'宋体';">步进程还是没有起来或第</span><span style="font-family:'Times New Roman';">3</span><span style="font-family:'宋体';">步不能提供服务，这时需要重新搭建一套</span><span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">服务，并修改所有使用</span><span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">服务的</span><span style="font-family:'Times New Roman';">hosts</span><span style="font-family:'宋体';">。</span></span></p>
<p style="text-align:justify;"><span style="font-family:'宋体';font-weight:bold;font-size:21px;">Zookeeper<span style="font-family:'宋体';">服务搭建：</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">1.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">将附件中的安装包解压到<span style="font-family:'Times New Roman';">linux</span><span style="font-family:'宋体';">机器上的&nbsp;</span><span style="font-family:'Times New Roman';">/usr/&nbsp;</span><span style="font-family:'宋体';">目录下；如：</span><span style="font-family:'Times New Roman';">/usr/zookeeper-3.4.6</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">2.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">修改附件中的<span style="font-family:'Times New Roman';">zoo.cfg</span><span style="font-family:'宋体';">文件，将文件中的的</span><span style="font-family:'Times New Roman';">ip</span><span style="font-family:'宋体';">修改为新机器的</span><span style="font-family:'Times New Roman';">ip</span><span style="font-family:'宋体';">；</span></span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-size:14px;">server.1=192.168.1.1:2888:3888</span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-size:14px;">server.2=192.168.1.2:2888:3888</span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-size:14px;">server.3=192.168.1.3:2888:3888</span></p>
<p><span style="font-family:'宋体';font-size:14px;">3.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">将修改完的<span style="font-family:'Times New Roman';">zoo.cfg</span><span style="font-family:'宋体';">文件拷贝到解压目录&nbsp;</span><span style="font-family:'Times New Roman';">/usr/zookeeper-3.4.6/conf/&nbsp;</span><span style="font-family:'宋体';">；</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">4.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">在新机器上创建以下目录和文件：</span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-weight:bold;font-size:14px;">/var/zookeeper/data/</span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-weight:bold;font-size:14px;">/var/zookeeper/logs/</span></p>
<p style="text-indent:28px;"><span style="font-family:'宋体';font-weight:bold;font-size:14px;">/var/zookeeper/data/myid&nbsp;<span style="font-family:'宋体';">该文件下要写上第</span><span style="font-family:'Times New Roman';">2</span><span style="font-family:'宋体';">步中</span><span style="font-family:'Times New Roman';">ip</span><span style="font-family:'宋体';">对应的</span><span style="font-family:'Times New Roman';">server.</span><span style="font-family:'宋体';">后面的数字，比如</span></span><span style="font-family:'宋体';font-size:14px;">192.168.1.1 ip<span style="font-family:'宋体';">对应的是</span><span style="font-family:'Times New Roman';">server.1</span><span style="font-family:'宋体';">，则该机器上的</span><span style="font-family:'Times New Roman';">myid</span><span style="font-family:'宋体';">中的内容就是</span><span style="font-family:'Times New Roman';">1</span><span style="font-family:'宋体';">。其他的都类似。</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">5.&nbsp;</span><span style="font-family:'宋体';font-size:14px;">到此为止<span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">服务就搭建完毕了，下面就需要启动</span><span style="font-family:'Times New Roman';">zookeeper</span><span style="font-family:'宋体';">了。</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;">&nbsp;（启动命令：<span style="font-family:'Times New Roman';">/usr/zookeeper-3.4.6/bin/&nbsp;</span><span style="font-family:'宋体';">目录下执行&nbsp;</span><span style="font-family:'Times New Roman';">./zkServer.sh&nbsp;start&nbsp;</span><span style="font-family:'宋体';">）</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;"><span style="font-family:'宋体';"><br></span></span></p>
<p><span style="font-family:'宋体';font-size:14px;"><span style="font-family:'宋体';">附件文件地址：</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;"><span style="font-family:'宋体';"><a href="http://down.51cto.com/data/2114349" target="_blank">http://down.51cto.com/data/2114349</a> </span></span></p>
<p><span style="font-family:'宋体';font-size:14px;"><br></span></p>
