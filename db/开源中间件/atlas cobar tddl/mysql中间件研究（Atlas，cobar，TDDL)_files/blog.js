/* @generated */G.def("draftNew",function(){function a(a,b,c){function f(){d._sendDraft(function(){d._timer=setTimeout(f,e)})}var d=this,e=c.interval||3e4;this._bodyLimit=c.bodyLimit||30,this._titleLimit=c.titleLimit||15,this._checkTitle=c.checkTitle||!0,this._isTitleChange=!1,this._isBodyChange=!1,this._prefix=c.prefix||"日志",this._isAsk=c.isAsk||!1,this._$title=c.$title||null,this._success=c.success||null,this._editor=a,this._api=b,this._timer=null,this._markBodyChange=function(){d._isBodyChange=!0},this._markTitleChange=function(){d._isTitleChange=!0},d._checkTitle&&this._$title.bind("keyup",function(){d._markTitleChange()}),this._editor.on("keyup",d._markBodyChange),f()}return"use strict",a.prototype._sendDraft=function(a){var b=this,c={},d=b._editor.getContent({format:"text"}),e=b._$title.val()||b._$title.text();c.body=b._editor?b._editor.getContent():"",c.type=b._prefix,c.location=window.location.href.split("?")[0].split("#")[0]+"#replyer",b._isBodyChange&&d.length>b._bodyLimit||b._isTitleChange&&e.length>b._titleLimit?(c.title=b._$title?$.trim(b._$title.val()||b._$title.text()):"未命名草稿",c.title||(c.title="未命名草稿"),b._api(c,function(){b._success(),b._isTitleChange=!1,b._isBodyChange=!1,a&&a.call(b)})):a&&a.call(b)},a.prototype.destory=function(){var a=this;a._timer&&(clearTimeout(a._timer),a._timer=0),a.checkTitle&&a._$title.unbind(),a._editor.off("keyup",a._markChange)},function(b,c,d){return new a(b,c,d)}}),G.def("ValidateUtils",function(){"use strict";var a=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,b=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@\?\^=%&:\/~\+#]*[\w\-@?\^=%&\/~\+#])?/;return{isEnglishAndNumber:function(a){return!a||/[^\x00-\xff]/ig.test(a)},isNickname:function(a){return!a||!a.match(/[^\u3400-\u4db5\u4e00-\u9fcbA-Za-z0-9._\-]/)},isNicknameLen:function(a){if(!a)return!0;var b=a.match(/[^\x00-\xff]/ig),c=a.length+(b==null?0:b.length);return c<=20},isEmail:function(b){return!b||a.test(b)},isUrl:function(a){return!a||b.test(a)},hasAngleBrackets:function(a){return!a||a.indexOf(">")===-1&&a.indexOf("<")===-1},isVcode:function(a){return!a||/^[0-9a-zA-Z]{4}$/.test(a)},isCJKWithSpace:function(a){return!a||!a.match(/[^\u3400-\u4db5\u4e00-\u9fcb\s\u3000]/)}}}),G.def("validate",["ValidateUtils"],function(a){function b(a){return a._isLive?$(a._selector):(a._$inputs||(a._$inputs=$(a._selector)),a._$inputs)}function c(a,b,c,d,e){var f=!0;for(var g in c){if(g.slice(0,1)==="_")continue;var h,i=c[g],j=c._desc,k=d[g];if(!k)continue;h=k.call(b,i,c,a);switch(h){case!0:break;case!1:e(!1,b,g,c),c._isValidated=!1;return;default:c._asyncValidateError=0,f=!1}}c._isValidated=!0,e(f||null,b,g,c)}function d(a,c){for(var d in c){var e=c[d],f=b(e);if(f.filter(a).length!==0)return e._isLive&&(e._$inputs=f),e}}function e(a,e,f,g,h){function i(a){var b=a.target,i=d(b,f);if(!i)return;if(e.beforeValidate&&!e.beforeValidate.call(null,b))return;c(b,i._$inputs,i,g,h),e.afterValidate&&e.afterValidate.call(null,b)}a.focusout(i).delegate("input","focus",function(a){var b=this,c=d(b,f);if(!c)return;c._isValidated=!1}).delegate("input","keydown",function(a){a.keyCode===13&&i(a)}).delegate("input:checkbox","change",function(a){i(a)}).submit(function(a){var d=this;if(d.sign===!0)return a.preventDefault(),!1;d.sign=!0;if(e.beforeFormValidate&&!e.beforeFormValidate.call(null,d))return a.preventDefault(),d.sign=!1,!1;var i,j,k=!0;for(i in f){j=f[i];if(j._isValidated&&j._asyncValidateError===0)continue;if(j._isValidated===!1||j._asyncValidateError!==0){k=!1;continue}c(null,b(j),j,g,h),j._isValidated===!1&&(k=!1)}if(k===!1)return a.preventDefault(),d.sign=!1,!1;if(e.afterFormValidate&&!e.afterFormValidate.call(null,d))return a.preventDefault(),d.sign=!1,!1;e.showAsyncMsg=!1,d.sign=!1})}function f(a,b){return function(){return b&&!b.apply(null,arguments)?!1:a.apply(null,arguments)}}function g(a,b){return function(){return a.apply(this,arguments)?b?b.apply(this,arguments):!0:!1}}return"use strict",function(d,h,i){var j={},k={showAsyncMsg:!0,msgClass:{error:"tip",success:"success"},msgPlace:function(a){return a.next()}},l={},m={pattern:function(a,b,c){return(new RegExp(a)).test(this.val())},required:function(a,b,c){return!a||!!this.val()},email:function(b,c,d){return a.isEmail(this.val())},url:function(b,c,d){return a.isUrl(this.val())},eq:function(b,c,d){var e=this;return l[b]||(l[b]=!0,j.afterValidate(function(a){$(a).is("#"+b)&&j.validate(d,e,c)})),e.val()===$("#"+b).val()},min:function(a){var b=this.val();return!b||parseInt(b,10)<=a},max:function(a){var b=this.val();return!b||parseInt(b,10)>=a},minlength:function(a,b,c){return this.val().length>=a},maxlength:function(a,b,c){return this.val().length<=a},nickname:function(){return a.isNickname(this.val())},nicknameLen:function(){return a.isNicknameLen(this.val())},async:function(a,b,c){var d=this.val(),e={},f=this;if(!d)return!0;e[a.param]=d,$.ajax({type:a.type||"POST",url:a.url,data:e,dataType:a.dataType||"json",success:function(c){j.asyncTrigger(a.success?a.success(c):c,f,"async",b,G.isFun(a.msg)?a.msg(c):a.msg)},error:function(){a.error&&a.error.call(f)}})}},n={pattern:"{desc}格式不正确",required:"{desc}是必填的",email:"{desc}格式不正确",url:"{desc}格式不正确",eq:"两次输入的{desc}不一致",min:"{desc}必需大于{arg}",max:"{desc}必需小于{arg}",minlength:"{desc}太短，至少{arg}个字",maxlength:"太长了，不能超过{arg}个字",nickname:"仅限中英文、数字、“.”、“-”及“_”",nicknameLen:"太长，最多10个汉字或者20个英文、数字"},o=$(d),p={};return j.validate=function(a,b,d){return c(a,b,d,m,j.trigger),this},j.getMsgPlace=function(a,b){var c=b._msgPlace;return c||(c=b._msgPlace=k.msgPlace(a)),c},j.trigger=function(a,b,c,d,e,f){var g=j.getMsgPlace(b,d),h=k.msgClass,i=d[c],l=d._desc;return e=n[c]||e,a==null?k.clearCallBack?k.clearCallBack.call(null,g,e,i,l):g.removeClass(h.error).removeClass(h.success).text(""):a===!0?(k.successCallBack?k.successCallBack.call(null,g,e,i,l):g.removeClass(h.error).addClass(h.success).html("&nbsp;"),f&&(d._asyncValidateError=0)):a===!1&&(k.errorCallBack?k.errorCallBack.call(null,g,e,i,l):g.removeClass(h.success).addClass(h.error).text(e.replace("{desc}",l).replace("{arg}",i)),f&&(d._asyncValidateError=1)),this},j.asyncTrigger=function(a,b,c,d,e){return d._isValidated&&k.showAsyncMsg&&j.trigger(!!a,b,c,d,e,!0),this},j.method=function(a,b,c){return m[a]=b,n[a]=c,this},j.rules=function(a){if(!a)return;var b,c;for(c in a)b=a[c],b._isValidated=null,b._asyncValidateError=0,b._selector||(b._selector="#"+c);return $.extend(p,a),this},j.afterFormValidate=function(a){var b=k.afterFormValidate;return k.afterFormValidate=f(a,b),this},j.beforeFormValidate=function(a){var b=k.beforeFormValidate;return k.beforeFormValidate=g(a,b),this},j.beforeValidate=function(a){var b=k.beforeValidate;return k.beforeValidate=g(a,b),this},j.afterValidate=function(a){var b=k.afterValidate;return k.afterValidate=function(){b&&b.apply(this,arguments),a.apply(this,arguments)},this},o.attr("novalidate",!0),$.extend(k,i),j.rules(h),e(o,k,p,m,j.trigger),j}}),G.def("jquery/easing",function(){jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b+c:d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b+c:-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){return b==0?c:b==e?c+d:(b/=e/2)<1?d/2*Math.pow(2,10*(b-1))+c:d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){return(b/=e/2)<1?-d/2*(Math.sqrt(1-b*b)-1)+c:d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin((b*e-f)*2*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e/2)==2)return c+d;g||(g=e*.3*1.5);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return b<1?-0.5*h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)+c:h*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)*.5+d+c},easeInBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),(b/=e/2)<1?d/2*b*b*(((f*=1.525)+1)*b-f)+c:d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(a,b,c,d,e){return d-jQuery.easing.easeOutBounce(a,e-b,0,d,e)+c},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(a,b,c,d,e){return b<e/2?jQuery.easing.easeInBounce(a,b*2,0,d,e)*.5+c:jQuery.easing.easeOutBounce(a,b*2-e,0,d,e)*.5+d*.5+c}})}),G.def("scrollTo",["jquery/easing"],function(a){function c(a){var b=window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,c=window.scrollY||window.pageYOffset||document.documentElement.scrollTop,d=c+(window.innerHeight||document.documentElement.clientHeight),e=b+(window.innerWidth||document.documentElement.clientWidth),f=a.scrollLeft,g=a.scrollTop,h=f+(a.width||0),i=g+(a.height||0),j=!1,k=!1;if(f!=null&&f<b||h>e)j=!0;if(g!=null&&g<c||i>d)k=!0;return j&&k?3:k?2:j?1:0}"use strict";var b=$("html,body");return function(a,d,e,f){function m(){b.animate(i,k||1e3,"easeInOutCirc",d?function a(){a.exed&&d(),a.exed=!0}:null)}var g=typeof a=="number",h=g?{top:a,left:a}:a.offset?a.offset():a,i={},j,k,l;typeof e=="number"?(k=e,l=typeof f=="string"?f:"top"):typeof e=="string"?(k=1e3,l=e):(k=1e3,l=g?"top":"all");switch(l){case"all":i.scrollTop=h.top,i.scrollLeft=h.left;break;case"top":i.scrollTop=h.top;break;case"left":i.scrollLeft=h.left;break;default:return}a.jquery&&(i.width=a.width(),i.height=a.height()),j=c(i),a.jquery&&(delete i.width,delete i.height);switch(j){case 0:return d&&d(),!1;case 1:return delete i.scrollTop,m(),!0;case 2:return delete i.scrollLeft,m(),!0;case 3:return m(),!0;default:}}}),G.def("toolTip",["scrollTo"],function(a){"use strict";var b='<div class="{klass}" style="position:absolute;z-index:{zIndex};">                    {msg}                    <b class="{klassArrow}" style="{pointBStyle}"><s class="{klassArrow}" style="{pointSStyle}"></s></b>                </div>',c={up:"left",down:"left",right:"top",left:"top"},d={up:"top:-20px;border-bottom-style:solid;",down:"bottom:-20px;border-top-style:solid;",right:"right:-20px;border-left-style:solid;",left:"left:-20px;border-right-style:solid;"},e={up:"top:-8px;left:-9px;border-bottom-style:solid;",down:"top:-10px;left:-9px;border-top-style:solid;",right:"top:-9px;left:-10px;border-left-style:solid;",left:"top:-9px;left:-8px;border-right-style:solid;"},f=function(f,g,h){function r(){q.css({top:j[0],left:j[1],width:n}),$("b",q).css(c[l],m),o.append(q)}function s(){q.remove(),h&&h()}var i=g.msg,j=g.position,k=$(g.coordinates),l=g.direction||"up",m=g.offset||0,n=g.width,o=$(f),p=o.offset(),q=$(G.format(b,{msg:i,direction:l,zIndex:g.zIndex||999,klass:g.klass||"tooltip",klassArrow:(g.klass||"tooltip")+"-"+l,pointSStyle:"position:absolute;border-width:9px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+e[l],pointBStyle:"position:absolute;border-width:10px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+d[l]}));return o.css("position","relative"),k.length&&(k=k.position(),j[0]+=k.top,j[1]+=k.left),r(),g.noscroll||a({top:j[0]+p.top+(l==="up"?-10:0),left:j[1]+p.left+(l==="left"?-10:0)}),{remove:s,$toolTip:q}};return f}),G.def("AliasUtils",["toolTip"],function(a){function c(a){var c=a!==undefined;if(b!==undefined){if(c){a(b);return}return b}$.ajax({url:"/apis/auth/external_oauth2.json",type:"GET",async:c,success:function(e){if(e.ok){(g_page_name==="postEditPage"||g_page_name==="askContentPage")&&d();var f=e.result,g={is_disabled:f.weibo===undefined},h={is_disabled:f.douban===undefined},i={is_disabled:!1,is_expired:!1};g.is_expired=g.is_disabled?!0:!f.weibo.access_token,h.is_expired=h.is_disabled?!0:!f.douban.access_token,b={weibo:g,douban:h,activity:i},c&&a(b)}},dataType:"json"});if(!c)return b}function d(){ukey&&$.ajax({url:"/apis/flowingboard/item/white_list.json",type:"GET",async:!0,success:function(a){if(a.ok){var c=a.result;for(var d in c)if(ukey===c[d].ukey){!b.weibo.is_disabled&&!b.weibo.is_expired&&$("#shareXl").attr("checked",!0),!b.douban.is_disabled&&!b.douban.is_expired&&$("#shareDb").attr("checked",!0);break}}},dataType:"json"})}"use strict";var b;return{checkAlias:function(b){var d=c();if(d===undefined)return;var e,f,g,h,i,j=$(b),k=!1;G.each(d,function(a,b){(a.is_disabled||a.is_expired)&&$("input[value="+b+"]",j).length&&(k=!0)}),k&&(f='<p style="margin-bottom:2px;line-height:1.5">{msg}</p>                                 <p>                                    <a href="{url}" target="_blank" class="sw_btn-ext" style="margin-right:5px;color: #666;">确定</a>                                    <a href="javascript:void 0;" class="closeBindTip" style="color:#666;">关闭</a>                                 </p>',e={weibo:{disabled:"去新浪微博授权后才可以发布，点击确定前往相应页面。",expired:"新浪微博授权已过期，点击确定前往相应页面重新授权。"},douban:{disabled:"去豆瓣网授权后才可以发布，点击确定前往相应页面。",expired:"豆瓣网授权已过期，点击确定前往相应页面重新授权。"}},h={weibo:weibo_signin,renren:renren_signin,douban:douban_signin},j.css("position","relative").delegate("label,:checkbox","click",function(b){function o(){g.remove(),d[k]={is_disabled:!1,is_expired:!1},c.sign=!1}function p(){g.remove(),c.sign=!1}var c=this,g,k,l,m,n;m=$(this),m.is("label")?n=$("#"+m.attr("for")):(n=m,m=$("label[for="+n.attr("id")+"]",j)),k=n.val(),l=d[k];if(l.is_disabled||l.is_expired){if(c.sign){b.preventDefault();return}c.sign=!0,b.preventDefault(),i=j.css("margin-bottom"),j.css("margin-bottom","100px"),g=a(j,{msg:G.format(f,{msg:e[k][l.is_disabled?"disabled":"expired"],url:h[k]}),width:200,offset:20,position:[30,-10],coordinates:n},function(){j.css("margin-bottom",i)}),$(".closeBindTip",g.$toolTip).one("click",p).prev().one("click",o)}}))},makeShareTmpl:function(a){var b=c(),d=g_page_name=="editBlogPage"||g_page_name=="postEditPage"?"checked":"";if(b===undefined)return"";var e,f,g=!1;return G.each(b,function(a,b){g=!0}),g?(e="<p>同时分享到：",f={weibo:'&nbsp;&nbsp;<input id="shareXl" type="checkbox" value="weibo" name="share_opts" /><label class="gicon-share-lsina" for="shareXl">新浪微博</label>',douban:'&nbsp;&nbsp;<input id="shareDb" type="checkbox" value="douban" name="share_opts" /><label class="gicon-share-ldb" for="shareDb">豆瓣网</label>',activity:'&nbsp;&nbsp;<input id="shareAc" type="checkbox" value="activity" name="share_opts"'+d+' /><label for="shareAc">动态</label>'},G.each(f,function(a,b){e+=a||""}),e+="</p>"):e=G.format('绑定其他帐号：<a class="gicon-share-lsina" target="_blank" href="{weibo}" title="绑定新浪微博帐号">新浪微博</a><!--<a class="gicon-share-lrr" target="_blank" href="{renren}" title="绑定人人网帐号">人人网</a>--><a class="gicon-share-ldb" target="_blank" href="{douban}" title="绑定豆瓣网帐号">豆瓣网</a>',{weibo:weibo_signin,renren:renren_signin,douban:douban_signin}),a&&$(a).html(e),e},makeRecoTmpl:function(a){var b=c();if(b===undefined)return"";var d,e,f=!1;return G.each(b,function(a,b){b!=="activity"&&!a.is_disabled&&!a.is_expired&&(f=!0)}),f?(d="同时分享到：",e={weibo:'&nbsp;&nbsp;<input id="recoXl" type="checkbox" class="recoShare" value="weibo" name="weibo" /><label class="gicon-share-lsina" for="recoXl">新浪微博</label>',douban:'&nbsp;&nbsp;<input id="recoDb" type="checkbox" class="recoShare" value="douban" name="douban" /><label class="gicon-share-ldb" for="recoRr">豆瓣网</label>'},G.each(b,function(a,b){!a.is_disabled&&!a.is_expired&&(d+=e[b]||"")}),a&&$(a).html(d),d):""}}}),G.def("tmpl",function(){function a(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var b={entities:a};return function(c,d){/\W/.test(c)||(c=document.getElementById(c).innerHTML);var e=new Function("funcs, obj","var p=[],print=function(){p.push.apply(p,arguments);};with(funcs){with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',entities($1),'").replace(/\t:=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}}return p.join('');");return d?e(b,d):function(a){return e(b,a)}}}),G.def("Base",function(){"use strict";var a=function(){};return a.extend=function(a,b){var c=b||this;for(var d in c)c.hasOwnProperty(d)&&d!=="prototype"&&(a[d]=c[d]);for(var e in c.prototype)c.prototype.hasOwnProperty(e)&&(a.prototype[e]=c.prototype[e])},a}),G.def("Event",["Base"],function(a){function c(){}"use strict";var b=Array.prototype.slice;return c.prototype.on=function(a,b,c,d){return this.eventQueue=this.eventQueue||{},this.eventQueue[a]=this.eventQueue[a]||[],this.eventQueue[a].push({callback:b,context:c,once:d}),this},c.prototype.off=function(a,b){this.eventQueue=this.eventQueue||{};if(this.eventQueue[a]==null)return;return b?(this.eventQueue[a]=G.filter(this.eventQueue[a],function(a,c){return a.callback!==b}),this.eventQueue[a].length===0&&delete this.eventQueue[a]):delete this.eventQueue[a],this},c.prototype.fire=function(a,c){this.eventQueue=this.eventQueue||{};var d=this.eventQueue[a],e=!0;if(d){var f=b.call(arguments,1);G.each(d,function(b){b.callback.apply(b.context,f)===!1&&(e=!1),b.once&&this.off(a,b.callback)},this)}return e},a.extend(c),c}),G.def("Menu",["tmpl","Event"],function(a,b){function d(b,d,e,f){G.isFun(e)||(f=e,e=null),this.$menu=$(a(c,{list:d,useFocus:f.useFocus,convert:f.convert,className:f.className||""})),this.$list=this.$menu.find("li"),this.selected=-1,this.data=d,this.doneCallBack=e;var g=this;g.$menu.appendTo(b).delegate("li","mouseenter",function(){var a=g.$list.index(this);if(g.selected===a)return;g.select(a,f.disableMouseChangeEvent)}).delegate("li","click",function(){var a=g.$list.index(this);g.selected=a,g.done()}).mouseleave(function(){g.select(-1,f.disableMouseChangeEvent)});if(f.useFocus){var h=g.$menu.children("a");h.keydown(function(a){a.preventDefault();switch(a.which){case 13:g.done();break;case 27:g.hide();break;case 40:g.down();break;case 38:g.up()}}).focus(function(){g.show(),g.selected===-1&&g.select(0)}),this.focus=function(){return h.focus(),this}}}"use strict";var c='<div class="gui-menu <%=className%>">                        <% if (useFocus) { %>                            <a href="#" tabindex="0" hidefocus="true" class="gui-menu-focus">&nbsp;</a>                        <% } %>                        <ul class="gui-menu-list">                            <% for (var i=0;i<list.length;i++) { %>                            <li>                                <% if (typeof convert !== "undefined") { %>                                    <%:=convert(list[i])%>                                <% } else { %>                                    <%=list[i]%>                                <% } %>                            </li>                            <% } %>                        </ul>                    </div>';return b.extend(d),d.prototype.up=function(){var a=this.selected-1;return a<0&&(a=this.data.length-1),this.select(a),this},d.prototype.down=function(){var a=this.selected+1;return a>this.data.length-1&&(a=0),this.select(a),this},d.prototype.select=function(a,b){if(a==null)return this.data[this.selected];if(a<-1||a>=this.data.length)a=-1;return!b&&this.selected!==a&&!this.fire("change",this.data[a])?this:(this.selected=a,this.$list.removeClass("selected"),this.selected!==-1&&$(this.$list[this.selected]).addClass("selected"),this)},d.prototype.remove=function(){if(!this.fire("remove"))return;this.$menu&&this.$menu.remove(),delete this.$menu,delete this.$list,delete this.selected,delete this.data,delete this.doneCallBack},d.prototype.show=function(){return this.$menu.show(),this},d.prototype.hide=function(){return this.fire("hide")?(this.$menu.hide(),this):this},d.prototype.onChange=function(a){return this.on("change",a,this),this},d.prototype.onRemove=function(a){return this.on("remove",a,this),this},d.prototype.onHide=function(a){return this.on("hide",a,this),this},d.prototype.done=function(){return this.doneCallBack&&this.doneCallBack.call(this,this.data[this.selected]),this},d}),G.def("Trie",function(){function b(a,b){var c=[];for(var d=0,e=a.length;d<e;d++)a[d].indexOf(b)!==-1&&c.push(a[d]);return c}function c(a){var b=[],c={},d;for(var e=0,f=a.length;e<f;e++)d=a[e],c[d]||(b.push(d),c[d]=!0);return b}function d(d,e,f,g){function i(c,d,f){if(c.length===0){j(f,a-d);return}var g;(g=f[c.slice(0,1)])?(g.$&&c.length===1&&(h=h.concat(g.$)),i(c.slice(1),d,g)):f.$&&(h=h.concat(b(f.$,e)))}function j(a,b){if(b===0)return;var c;for(var d in a)c=a[d],c.$&&(h=h.concat(c.$)),j(c,b-1)}var h=[];e=new String(e),g&&(e=g(e)),i(e,e.length,d),f(c(h))}"use strict";var a=G.ua.isIE6?3:5;return function(b,c,e){var f,g=!1,h=!1,i,j,k="";typeof g_obj_id!="undefined"&&(k=g_obj_id),G.isFun(b)?g||(g=!0,b(a,G.ua.isIE6?"":k,function(a){g=!1,f=e?e(a):a,i&&j&&d(f,i,j,c)},function(){h=!0,g=!1,e&&e()})):f=b,this.calculate=function(a,b){if(!a||h){b();return}g?(i=a,j=b):d(f,a,b,c)},this.isLoading=function(){return g},this.isFailed=function(){return h}}}),G.def("TextUtils",function(){function l(a,b){var c=typeof a[b];return c==="function"||c=="object"&&!!a[b]||c=="unknown"}function m(b,c){return typeof b[c]!=a}function n(a,b){return typeof a[b]=="object"&&!!a[b]}function o(a){window.console&&window.console.log&&window.console.log("TextInputs module for Rangy not supported in your browser. Reason: "+a)}function p(b,c,d){return c<0&&(c+=b.value.length),typeof d==a&&(d=c),d<0&&(d+=b.value.length),{start:c,end:d}}function q(a,b,c){return{start:b,end:c,length:c-b,text:a.value.slice(b,c)}}function r(){return n(document,"body")?document.body:document.getElementsByTagName("body")[0]}function u(a,b){return function(){var c=this.jquery?this[0]:this,d=c.nodeName.toLowerCase();if(c.nodeType==1&&(d=="textarea"||d=="input"&&c.type=="text")){var e=[c].concat(Array.prototype.slice.call(arguments)),f=a.apply(this,e);if(!b)return f}if(b)return this}}"use strict";var a="undefined",b,c,d,e,f,g,h,i,j,k,s=document.createElement("textarea");r().appendChild(s);if(m(s,"selectionStart")&&m(s,"selectionEnd")&&l(s,"setSelectionRange"))b=function(a){var b=a.selectionStart,c=a.selectionEnd;return q(a,b,c)},c=function(a,b,c){var d=p(a,b,c);a.focus(),a.setSelectionRange(d.start,d.end)},j=function(a,b){b?a.selectionEnd=a.selectionStart:a.selectionStart=a.selectionEnd};else{if(!(l(s,"createTextRange")&&n(document,"selection")&&l(document.selection,"createRange"))){r().removeChild(s),o("No means of finding text input caret position");return}b=function(a){a.focus();var b=0,c=0,d,e,f,g,h=document.selection.createRange();return h&&h.parentElement()==a&&(f=a.value.length,d=a.value.replace(/\r\n/g,"\n"),e=a.createTextRange(),e.moveToBookmark(h.getBookmark()),g=a.createTextRange(),g.collapse(!1),e.compareEndPoints("StartToEnd",g)>-1?b=c=f:(b=-e.moveStart("character",-f),b+=d.slice(0,b).split("\n").length-1,e.compareEndPoints("EndToEnd",g)>-1?c=f:(c=-e.moveEnd("character",-f),c+=d.slice(0,c).split("\n").length-1))),q(a,b,c)};var t=function(a,b){return b-(a.value.slice(0,b).split("\r\n").length-1)};c=function(a,b,c){var d=p(a,b,c),e=a.createTextRange(),f=t(a,d.start);e.collapse(!0),d.start==d.end?e.move("character",f):(e.moveEnd("character",t(a,d.end)),e.moveStart("character",f)),e.select()},j=function(a,b){var c=document.selection.createRange();c.collapse(b),c.select()}}r().removeChild(s),e=function(a,b,d,e){var f;b!=d&&(f=a.value,a.value=f.slice(0,b)+f.slice(d)),e&&c(a,b,b)},d=function(a){var c=b(a);e(a,c.start,c.end,!0)},i=function(a){var d=b(a),e;return d.start!=d.end&&(e=a.value,a.value=e.slice(0,d.start)+e.slice(d.end)),c(a,d.start,d.start),d.text},k=function(a,b){b==null&&(b=a.value.length),c(a,b,b)},f=function(a,b,d,e){var f=a.value,g;a.value=f.slice(0,d)+b+f.slice(d),e&&(g=d+b.length,c(a,g,g))},g=function(a,d){var e=b(a),f=a.value;a.value=f.slice(0,e.start)+d+f.slice(e.end);var g=e.start+d.length;c(a,g,g)},h=function(a,d,e){var f=b(a),g=a.value;a.value=g.slice(0,f.start)+d+f.text+e+g.slice(f.end);var h=f.start+d.length,i=h+f.length;c(a,h,i)},$.fn.extend({getSelection:u(b,!1),setSelection:u(c,!0),collapseSelection:u(j,!0),deleteSelectedText:u(d,!0),deleteText:u(e,!0),extractSelectedText:u(i,!1),insertText:u(f,!0),replaceSelectedText:u(g,!0),surroundSelectedText:u(h,!0),insertCaret:u(k,!0)})}),G.def("at",["tmpl","Menu","Trie","TextUtils"],function(a,b,c,d){function u(a){!$.contains(j[0],a.target)&&k[0]!==a.target&&y()}function v(a,b,c,d){$.ajax({type:"get",url:"/apis/community/relationship/following_nickname.json",success:function(a){a.ok&&c(a.result)},error:d,dataType:"json"})}function w(){if(w.inited)return;i=$("body"),j=$(e).appendTo(i),k?j.css("marginTop","30px"):k=j.prepend(f).find("input"),l=j.children("div"),q=new c(v,function(a){return a.toLowerCase().replace(s,"")},function(b){return l.html(a(g,{tip:b==null?null:t.tip,noneTip:b==null?t.loadFailTip:null})),p&&p.remove(),b});var b=!1;k.keydown(function(a){switch(a.which){case 13:a.preventDefault(),y(k.val()),b=!1;break;case 27:a.preventDefault(),y(),b=!1;break;case 40:p&&(b=!0,a.preventDefault(),p.down());break;case 38:p&&(b=!0,a.preventDefault(),p.up());break;case 8:k.val().length===0&&(a.preventDefault(),y()),b=!1;break;default:setTimeout(function(){var a=k.val();a&&a.slice(a.length-1).match(r)&&(a=a.replace(r,""),y(a))}),b=!1}}),window.addEventListener?k[0].addEventListener("input",function(){x(k.val())},!1):window.attachEvent&&k[0].attachEvent("onpropertychange",function(){!b&&window.event.propertyName=="value"&&x(k.val())}),w.inited=!0}function x(c){var d=null,e=null;q.calculate(c,function(c){q.isFailed()?d=t.loadFailTip:q.isLoading()?e=t.loadingTip:c==null?e=t.tip:c.length===0&&(d=t.noneTip),l.html(a(g,{tip:e,noneTip:d})),p&&p.remove(),c&&c.length>0&&(c=c.slice(0,10),p=(new b(l,c,function(a){y(a)},{useFocus:!0,disableMouseChangeEvent:!0})).onChange(function(a){k.val(a)}).onHide(function(){k.insertCaret()}))})}function y(a){a==="妹子"&&alert("﹁_﹁，出门右转是性情！"),j.css("left",-99999),a?m(a+" "):n(),i.unbind("click",u),h&&h.unbind("click",u),o=!1}"use strict";var e='<div class="gui-at"><div></div></div>',f='<input class="gbtxt"/>',g='<% if(tip) { %><p><%=tip%></p><% } %><% if (noneTip) { %><p class="gui-at-none"><%=noneTip%></p><% } %>',h,i,j,k,l,m,n,o=!1,p,q,r=/[^\u3400-\u4db5\u4e00-\u9fcba-zA-Z0-9._\-]/g,s=/[^\u3400-\u4db5\u4e00-\u9fcba-z0-9]/g,t={tip:"输入对方昵称来@TA",loadFailTip:"获取失败，请刷新页面重试",loadingTip:"获取用户列表中...",noneTip:"关注列表无匹配，回车键确认输入"};return function(b,c,d,e,f){if(o)return;o=!0,m=c,n=d,e&&(h=e),f&&(k=f),setTimeout(function(){w(),j.css({top:b.top,left:b.left,display:"block"}),f||k.val(""),k.focus(),x(k.val()),i.click(u),h&&h.click(u)})}}),G.def("./blog/editBlogPage",["../lib/draftNew","../lib/ValidateUtils","../lib/validate","../lib/AliasUtils","../lib/at"],function(a,b,c,d,e){return{login:function(){function p(a,b){h.html('<i class="gicon-draft-save"></i>正在保存').css({visibility:"visible",cursor:"default"}),$.ajax({url:"/apis/community/draft.json",type:"post",data:a,success:function(a){a.ok&&b&&(f=a.result.id,i++,b())},error:function(){i=0,b&&b()},dataType:"json"})}function q(){i?(h.html('<i class="gicon-draft-save"></i>已保存').css({visibility:"visible",cursor:"pointer"}),i===1&&h.hover(function(){str=$(this).html(),$(this).html('<i class="gicon-draft-del"></i>删除草稿').css("cursor","pointer")},function(){$(this).html('<i class="gicon-draft-save"></i>已保存')}).click(function(a){g&&confirm("确定要删除草稿并清空编辑框吗？")&&(g=!1,$.ajax({url:"/apis/community/draft.json",type:"delete",data:{ids:f},success:function(a){j.val(""),s.setContent(""),g=!0,i=0,h.unbind()},dataType:"json"}),$(this).css("visibility","hidden"))})):(h.html('<i class="gicon-draft-save"></i>正在保存').css({visibility:"visible",cursor:"default"}),h.unbind())}function r(){c=a(tinyMCE.activeEditor,p,b),$(window).delegate("#stop","click",function(){c&&c.destory()})}function t(){if(tinyMCE.activeEditor){s=tinyMCE.activeEditor;return}setTimeout(t,100)}function u(a){a=a.target;if(a.sign===!0)return!1;a.sign=!0;var b=$.trim(j.val()).length,c=s.dom.doc.body.innerText!=null?s.dom.doc.body.innerText:s.dom.doc.body.textContent,d=c.trim().length,e=$("#captcha"),f;if(b===0)return alert("标题不能为空"),a.sign=!1,!1;if(b>k)return alert("标题字数不能超过"+k+"字"),a.sign=!1,!1;if(!s.getContent().trim())return alert("内容不能为空"),a.sign=!1,!1;if(d>m)return alert("内容字数不能超过"+m+"字"),a.sign=!1,!1;f=G.unique(c.match(n));if(f&&f.length>50)return alert("对不起，不能@超过50个人"),a.sign=!1,!1;if(e.length&&e.attr("type")==="text"&&!e.val())return alert("验证码不能为空"),a.sign=!1,!1}var b,c,f,g=!0,h=$("#draftTip"),i=0,j=$("#title"),k=100,l=g_page_name==="postEdit",m=1e4,n=/@[\u3400-\u4db5\u4e00-\u9fcba-zA-Z0-9\._\-]+/g;setTimeout(function(){$.get("/apis/auth/external_oauth2/"+ukey+".json",function(a){a.ok&&(a.result.weibo&&$("#shareXl").attr("checked","checked"),a.result.douban&&$("#shareDb").attr("checked","checked"))},"json")},1e3);var o=$("#submitTip");$(".gbtn-submit").hover(function(){o.show()},function(){o.hide()}),b={success:function(){q()},interval:2e4,$title:$("#title"),prefix:"日志"},window.initEditor("#postEdit textarea:first",{content_css:tinymceContentCSS,submit_form_selector:"#postEdit",setup:function(a){a.on("init",function(a,b){r()})},atFunc:e});var s=null;t(),j.keydown(function(a){a.which===9&&(a.preventDefault(),s&&s.focus())}).insertCaret(),$("#postEdit").submit(u),$checkAlias=$("#checkAlias"),$checkAlias.html(d.makeShareTmpl()),d.checkAlias($checkAlias),$("#captchaImage").doOnce(function(){function e(b){b.preventDefault(),a.attr("src",c+"?v="+d++)}var a=$("#captchaImage"),b=$("#changeCaptchaImage"),c=a.attr("src"),d=1;b.click(e),a.click(e)}),typeof g_error!="undefined"&&g_error&&alert(g_error)}}}),G.def("support",function(){"use strict";var a=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),b="Webkit Moz O ms Khtml".split(" "),c=document.createElement("div");return{fixed:function d(){if(typeof d.r!="undefined")return d.r;var a=!0;if(G.ua.isIpad||G.ua.isIphone)a=navigator.userAgent.match(/[5-9]_[0-9]/)!==null;else{var b=document.createElement("div"),c=document.createElement("div");b.style.position="absolute",b.style.top="200px",c.style.position="fixed",c.style.top="100px",b.appendChild(c),document.body.appendChild(b),c.getBoundingClientRect&&c.getBoundingClientRect().top==b.getBoundingClientRect().top&&(a=!1),document.body.removeChild(b),b=null,c=null}return d.r=a,a},touchEvent:function e(){if(typeof e.r!="undefined")return e.r;var a=!0,b=["touchstart","touchmove","touchend","touchcancel"];for(var d=0,f=b.length;d<f;d++){var g=b[d];g="on"+g;var h=g in c;h||(c.setAttribute(g,"return;"),h=typeof c[g]=="function");if(!h){a=!1;break}}return e.r=a,a},cssanimation:function f(){if(typeof f.r!="undefined")return f.r;var a=!1,d=c.style,e="animationName",g=e.charAt(0).toUpperCase()+e.substr(1),h=(e+" "+b.join(g+" ")+g).split(" ");for(var i in h)if(d[h[i]]!==undefined){a=!0;break}return f.r=a,a}}}),G.def("Overlay",["support","Event"],function(a,b){function r(a){var b,c;a?(b=(g.height()-l.height())/2+(document.documentElement.scrollTop||window.pageYOffset||0),c=(g.width()-l.width())/2+(document.documentElement.scrollLeft||window.pageXOffset||0)):(b=(g.height()-l.height())/2,c=(g.width()-l.width())/2),l.css({top:b,left:c})}function s(a,b){o&&o.length&&o.css({opacity:a||.5,"background-color":b||"#000"}).show()}function t(){o&&o.length&&o.hide()}function u(){o.css({top:document.documentElement.scrollTop||window.pageYOffset||0,left:document.documentElement.scrollLeft||window.pageXOffset||0})}function v(){o.css({width:g.width(),height:g.height()})}function w(){G.ua.isIE6&&o&&o.length&&(o.css({position:"absolute",bottom:"auto",right:"auto"}),v(),u())}function x(b){if(x.inited)return;x.inited=!0,d=b||"gui",e='<div id="blockWindow" class="'+d+'-block">                           <div class="'+d+'-block-b">                               <h4 class="'+d+'-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose '+d+'-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="'+d+'-block-bd"></div>                           </div>                       </div>',l=$(e),l.appendTo("body"),m=$(h),n=$(i),q=[l,m],navigator.userAgent.match(/iPad|iPhone/i)!==null?k=navigator.userAgent.match(/[5-9]_[0-9]/)!==null:(k=a.fixed(),g.resize(function(){p&&p.pos()})),G.ua.isIE6&&g.resize(function(){o&&o.length&&p&&v()}).scroll(function(){o&&o.length&&p&&u()}),l.delegate(j,"click",function(a){a.preventDefault(),p&&p.close()})}function y(a,b,c,d){this._isOpen=!1,x.call(this,d),this._fixed=k,this._coverNeedShowed=!1,this._initedCover=!1,a&&!d&&this.open(a,b,c)}"use strict";var c=0,d,e='<div id="blockWindow" class="gui-block">                           <div class="gui-block-b">                               <h4 class="gui-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose gui-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="gui-block-bd"></div>                           </div>                       </div>',f='<iframe src="{v}" id="blockIframe" frameborder="0" width="100%"></iframe>',g=$(window),h="#blockContent",i="#blockTitle",j=".blockClose",k,l,m,n,o,p,q;return y.prototype={openCallBack:function(a){return a&&this.on("open",a,this),this},closeCallBack:function(a){return a&&this.on("close",a,this),this},afterClose:function(a){return a&&this.on("afterClose",a,this),this},afterOpen:function(a){return a&&this.on("afterOpen",a,this),this},isOpen:function(){return this._isOpen},close:function(){return this._isOpen?this.fire("close",q)?(l.hide(),this._isOpen=!1,p=null,this.fire("afterClose",q),this):this:this},open:function(a,b,c){return this.fire("open",q)?(p&&p!==this&&p.close(),p=this,this.undelegate(),b&&this.delegate(b),a&&!G.isHtml(a)&&(a=G.format(f,a)),m.html(a||""),this._title&&n.html(this._title),this._width&&l.width(this._width),l.css("position",!this._fixed||!k?"absolute":"fixed"),this.pos(),l.show(),this._isOpen=!0,c&&c.call(this,m),this.fire("afterOpen",q),this):this},delegate:function(a){if(!a.length){m.delegate(a.selector,a.event,a.func);return}return G.each(a,function(a){this.delegate(a.selector,a.event,a.func)},m),this},undelegate:function(){return m.undelegate(),this},pos:function(){return r(!this._fixed||!k),G.ua.isIE6&&this._cover&&this._cover.length&&this._cover.css(),this},title:function(a){return this._title=a,this._isOpen&&n.html(a),this},width:function(a){return this._width=a,this._isOpen&&(l.width(a),this.pos()),this},pin:function(){if(this._fixed||!k)return;return this._fixed=!0,this._isOpen&&(l.css("position","fixed"),this.pos()),this},unpin:function(){if(!this._fixed)return;return this._fixed=!1,this._isOpen&&(l.css("position","absolute"),this.pos()),this},showCover:function(a,b){if(!o||!o.length)o=$('<div style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;z-index:'+((parseInt(l.css("z-index"),10)||0)-1)+';"></div>').appendTo("body"),w();if(!this._initedCover){var c=this;this.on("afterClose",function(){c._coverNeedShowed&&t()}).on("afterOpen",function(){c._coverNeedShowed&&s(c._coverOpacity,c._coverColor)}),this._initedCover=!0}return typeof a=="string"&&(b=a,a=null),a&&(this._coverOpacity=a),b&&(this._coverColor=b),s(a||this._coverOpacity,b||this._coverColor),this._coverNeedShowed=!0,this},hideCover:function(){return t(),this._coverNeedShowed=!1,this}},b.extend(y),y}),G.def("placeholder",function(){function b(a,b){var c=a.attr("type");if(a.val()==="")if(c!=="password")a.data("origColor",a.css("color")).val(b).css("color","#BBB");else{var d=parseInt(a.css("margin-right")),e=parseInt(a.css("border-right-width")),f=parseInt(a.css("padding-right")),g=a.width(),h=d+e+f+g,i=a.css("font-size"),j=a.outerHeight(),k=$('<span class="_input_placeholder">'+b+"</span>").insertAfter(a).css({color:"#BBB",fontSize:i,lineHeight:j+"px",height:j+"px",marginLeft:"-"+h+"px"});k.css("margin-right",h-k.width()+"px")}}function c(a,b){var c=a.attr("type"),d=a.val();c!=="password"&&d===b?a.val("").css("color",a.data("origColor")):c=="password"&&d===""&&a.next("span._input_placeholder").remove()}"use strict";var a=document.createElement("textarea").placeholder==="";return{init:function(d){if(!a){var e=$(d),f=e.attr("placeholder");b(e,f),e.focus(function(){c(e,f)}).blur(function(){b(e,f)})}return this},submit:function(b,c,d){var e=$(b),f=$(c);return a?f.submit(d):f.submit(function(){var a=e.attr("placeholder"),b=e.val();return b===a&&e.val(""),d.apply(this,arguments)}),this},support:a}}),G.def("Anime",["support"],function(a){return"use strict",{addCssString:function(a){var b=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(b),b.setAttribute("type","text/css"),b.styleSheet?b.styleSheet.cssText=a:b.innerHTML+=a},loading:function(a){a.jquery||(a=$(a))},flipping:function(b,c,d,e){function h(){e&&e(b)}c=c||500,d=d||0;var f=".flip-container {                        -webkit-perspective: 1000;                        -moz-perspective: 1000;                        -o-perspective: 1000;                        perspective: 1000;                    }                    .gui-anime-flipping {                        -webkit-transform: rotateY(180deg);                        -moz-transform: rotateY(180deg);                        -o-transform: rotateY(180deg);                        transform: rotateY(180deg);                    }                    .flipper {                        -webkit-transition: <t>s;                        -webkit-transform-style: preserve-3d;                        -moz-transition: <t>s;                        -moz-transform-style: preserve-3d;                        -o-transition: <t>s;                        -o-transform-style: preserve-3d;                        transition: <t>s;                        transform-style: preserve-3d;                        position: relative;                    }                    .front, .back {                        -webkit-backface-visibility: hidden;                        -moz-backface-visibility: hidden;                        -o-backface-visibility: hidden;                        backface-visibility: hidden;                        position: absolute;                        top: 0;                        left: 0;                    }                    .front {                        z-index: 2;                    }                    .back {                        -webkit-transform: rotateY(180deg);                        -moz-transform: rotateY(180deg);                        -o-transform: rotateY(180deg);                        transform: rotateY(180deg);                }";if(!a.cssanimation()){b.children(":visible").fadeOut(c/2,function(){$(this).siblings().fadeIn(c/2)}),e&&e(b);return}if(!this.flippingCssAdded){try{this.addCssString(G.format(f,{t:c/1e3,d:d/1e3},/<([^<>]+)>/g))}catch(g){e&&e(b);return}this.flippingCssAdded=!0}b.find(".hide").removeClass("hide"),b.hasClass("gui-anime-flipping")?(b.removeClass("gui-anime-flipping"),setTimeout(function(){b.find(".back").addClass("hide")},c/2)):(b.addClass("gui-anime-flipping"),setTimeout(function(){b.find(".front").addClass("hide")},c/2)),setTimeout(h,c+d)},focusing:function(b,c,d,e){function g(){b.removeClass("gui-anime-focusing"),c&&c(b)}if(!a.cssanimation()){c&&c(b);return}d=d||500,e=e||0;if(!this.focusingCssAdded){try{this.addCssString(G.format("@-webkit-keyframes guiFocusing {                            0%{-webkit-transform: scale(4); opacity:0;}                            100%{-webkit-transform: scale(1); opacity:1;}                        }                        @-moz-keyframes guiFocusing {                            0%{-moz-transform: scale(4); opacity:0;}                            100%{-moz-transform: scale(1); opacity:1;}                        }                        @-o-keyframes guiFocusing {                            0%{-o-transform: scale(4); opacity:0;}                            100%{-o-transform: scale(1); opacity:1;}                        }                        @-ms-keyframes guiFocusing {                            0%{-ms-transform: scale(4); opacity:0;}                            100%{-ms-transform: scale(1); opacity:1;}                        }                        @keyframes guiFocusing {                            0%{transform: scale(4); opacity:0;}                            100%{transform: scale(1); opacity:1;}                        }                        .gui-anime-focusing {                            -webkit-animation-name: guiFocusing;                            -webkit-animation-duration: <t>s;                            -webkit-animation-delay: <d>s;                            -webkit-animation-timing-function: ease-out;                            -moz-animation-name: guiFocusing;                            -moz-animation-duration: <t>s;                            -moz-animation-delay: <d>s;                            -moz-animation-timing-function: ease-out;                            animation-name: guiFocusing;                            animation-duration: <t>s;                            animation-delay: <d>s;                            animation-timing-function: ease-out;                        }",{t:d/1e3,d:e/1e3},/<([^<>]+)>/g))}catch(f){c&&c(b);return}this.focusingCssAdded=!0}b.addClass("gui-anime-focusing"),setTimeout(g,d+e)},shaking:function(b,c,d,e){function g(){b.removeClass("gui-anime-shaking"),b.removeClass("gui-anime-shaking-inline"),c&&c(b)}if(!a.cssanimation()){c&&c(b);return}d=d||500,e=e||0;if(!this.shakingCssAdded){try{this.addCssString(G.format("@-webkit-keyframes guiShaking {                            0% { -webkit-transform: translate(2px, 1px) rotate(0deg);transform: translate(2px, 1px) rotate(0deg); }                            10% { -webkit-transform: translate(-1px, -2px) rotate(-1deg);transform: translate(-1px, -2px) rotate(-1deg); }                            20% { -webkit-transform: translate(-3px, 0px) rotate(1deg);transform: translate(-3px, 0px) rotate(1deg); }                            30% { -webkit-transform: translate(0px, 2px) rotate(0deg);transform: translate(0px, 2px) rotate(0deg); }                            40% { -webkit-transform: translate(1px, -1px) rotate(1deg);transform: translate(1px, -1px) rotate(1deg); }                            50% { -webkit-transform: translate(-1px, 2px) rotate(-1deg);transform: translate(-1px, 2px) rotate(-1deg); }                            60% { -webkit-transform: translate(-3px, 1px) rotate(0deg);transform: translate(-3px, 1px) rotate(0deg); }                            70% { -webkit-transform: translate(2px, 1px) rotate(-1deg);transform: translate(2px, 1px) rotate(-1deg); }                            80% { -webkit-transform: translate(-1px, -1px) rotate(1deg);transform: translate(-1px, -1px) rotate(1deg); }                            90% { -webkit-transform: translate(2px, 2px) rotate(0deg);transform: translate(2px, 2px) rotate(0deg); }                            100% { -webkit-transform: translate(1px, -2px) rotate(-1deg);transform: translate(1px, -2px) rotate(-1deg); }                          }                          @-moz-keyframes guiShaking {                            0% { -moz-transform: translate(2px, 1px) rotate(0deg);transform: translate(2px, 1px) rotate(0deg); }                            10% { -moz-transform: translate(-1px, -2px) rotate(-1deg);transform: translate(-1px, -2px) rotate(-1deg); }                            20% { -moz-transform: translate(-3px, 0px) rotate(1deg);transform: translate(-3px, 0px) rotate(1deg); }                            30% { -moz-transform: translate(0px, 2px) rotate(0deg);transform: translate(0px, 2px) rotate(0deg); }                            40% { -moz-transform: translate(1px, -1px) rotate(1deg);transform: translate(1px, -1px) rotate(1deg); }                            50% { -moz-transform: translate(-1px, 2px) rotate(-1deg);transform: translate(-1px, 2px) rotate(-1deg); }                            60% { -moz-transform: translate(-3px, 1px) rotate(0deg);transform: translate(-3px, 1px) rotate(0deg); }                            70% { -moz-transform: translate(2px, 1px) rotate(-1deg);transform: translate(2px, 1px) rotate(-1deg); }                            80% { -moz-transform: translate(-1px, -1px) rotate(1deg);transform: translate(-1px, -1px) rotate(1deg); }                            90% { -moz-transform: translate(2px, 2px) rotate(0deg);transform: translate(2px, 2px) rotate(0deg); }                            100% { -moz-transform: translate(1px, -2px) rotate(-1deg);transform: translate(1px, -2px) rotate(-1deg); }                          }                          @keyframes guiShaking {                            0% { transform: translate(2px, 1px) rotate(0deg); }                            10% { transform: translate(-1px, -2px) rotate(-1deg); }                            20% { transform: translate(-3px, 0px) rotate(1deg); }                            30% { transform: translate(0px, 2px) rotate(0deg); }                            40% { transform: translate(1px, -1px) rotate(1deg); }                            50% { transform: translate(-1px, 2px) rotate(-1deg); }                            60% { transform: translate(-3px, 1px) rotate(0deg); }                            70% { transform: translate(2px, 1px) rotate(-1deg); }                            80% { transform: translate(-1px, -1px) rotate(1deg); }                            90% { transform: translate(2px, 2px) rotate(0deg); }                            100% { transform: translate(1px, -2px) rotate(-1deg); }                          }                          .gui-anime-shaking-inline,                          .gui-anime-shaking {                            display:block;                            position: relative;                            -webkit-animation-name: guiShaking;                            -webkit-animation-duration: <t>s;                            -webkit-animation-delay: <d>s;                            -webkit-transform-origin:50% 50%;                            -webkit-animation-iteration-count: 1;                            -webkit-animation-timing-function: linear;                            -moz-animation-name: guiShaking;                            -moz-animation-duration: <t>s;                            -moz-animation-delay: <d>s;                            -moz-transform-origin:50% 50%;                            -moz-animation-iteration-count: 1;                            -moz-animation-timing-function: linear;                            animation-name: guiShaking;                            animation-duration: <t>s;                            animation-delay: <d>s;                            transform-origin:50% 50%;                            animation-iteration-count: 1;                            animation-timing-function: linear;                          }                          .gui-anime-shaking-inline {                            display: inline-block;                        }",{t:d/1e3,d:e/1e3},/<([^<>]+)>/g))}catch(f){c&&c(b);return}this.shakingCssAdded=!0}b.css("display")==="inline"?b.addClass("gui-anime-shaking-inline"):b.addClass("gui-anime-shaking"),setTimeout(g,d+e)}}}),G.def("Count",["Anime"],function(a){function c(a,c,d,e){var f=b.exec(a.text()),g;g=+f[2]+c,d!=null&&(g=Math.max(d,g)),e!=null&&(g=Math.min(e,g)),a.text(f?(f[1]||"")+g+(f[3]||""):"")}function d(a,c,d,e){var f=b.exec(a.text());d!=null&&(c=Math.max(d,c)),e!=null&&(c=Math.min(e,c)),a.text(f?(f[1]||"")+c+(f[3]||""):"")}"use strict";var b=/([^\-0-9]+)?([\-0-9]+)([\w\W]+)?/;return function(b,e,f){var g=$(b);this.add=function(b,d){return c(g,b,e,f),d&&a[d](g),this},this.set=function(a){return d(g,a,e,f),this}}}),G.def("Recommend",["Overlay","placeholder","AliasUtils","Count"],function(a,b,c,d){"use strict";var e=function(){return{timerOut:0,url:"/apis/community/user/recommend.json",recommendApi:function(a,b,c){var d=this;$.ajax({url:d.url,type:"POST",data:a,success:function(a){a.ok&&b&&b()},error:function(){c?c():alert("出错啦！")},dataType:"json"})},show:function(b,d,e){var f=this,g={done:"已推荐",tips:{tooLong:"推荐文字不能超过100个字",repeat:"1010分钟之内只能推荐1次"},title:"推荐给关注我的人",placeholder:"说几句话，向关注我的人推荐本文",timer:3e3,successTitle:"推荐成功"},h=new a;$.extend(g,e);var i='<div class="gui-block-reco">                                                <textarea class="t_txt" id="recommendText" placeholder="'+g.placeholder+'"></textarea>                                                <p class="recoShareBox fl">'+c.makeRecoTmpl()+'</p><p class="fr"><a id="recoBt" href="javascript:void 0;" data-operation="ok" class="gbtn" title="确定">确定</a><a class="blockClose sw_btn" href="javascript:void 0;" title="关闭">关闭</a></p>                                              </div>',j='<div class="gui-block-reco">                                            <p class="gui-block-reco-txt">关注你的人会在最新动态里看到你的推荐</p>                                            <p class="fr">                                                <a href="'+activity_url+'" class="gui-block-reco-link" title="查看动态" target="_blank">查看动态</a>                                                <a href="javascript:void 0;" title="关闭" class="blockClose sw_btn">关闭</a>                                            </p>                                        </div>';h.open(i,{event:"click",selector:"[data-operation=ok]",func:function(){return f.sendRecommend(h,b,j,d,g),this}},function(){h.title(g.title)}).closeCallBack(function(){f.timerOut&&clearTimeout(f.timerOut)})},sendRecommend:function(a,b,c,e,f){var g=this,h=$.trim($("#recommendText").val()),i=$(".recoShareBox").find("input:checked"),j=["activity"],k=new d(e);if(h.length>=100)return alert(f.tips.tooLong),!1;i.length&&i.each(function(a){j.push($(this).val())}),b.comment=h,b.target=j,g.recommendApi(b,function(){k.add(1),a.open(c).title(f.successTitle),e.html(e.html().replace(/^推荐/,"已推荐")),g.autoClose(a,f.timer)})},autoClose:function(a,b){var c=this;c.timerOut=setTimeout(function(){a.close()},b)}}};return e}),G.def("./blog/indexPage",["../lib/Recommend","../lib/Count","../lib/tmpl"],function(a,b,c){return{login:function(){$("#blogList").delegate(".recoBtn","click",function(){function g(c,d){var e=new a,f=d,g=c.find(".reco-num"),h=new b(g);f.comment=$.trim($("#recommendText").val()),f.target=["activity"],e.recommendApi(f,function(){h.add(1)},function(){c.attr("title","推荐"),c.removeClass("reco-ed").addClass("reco"),console.error("出错了！推荐失败～")})}var c=$(this),d,e,f;c.hasClass("reco-ed")||(c.attr("title","已推荐"),c.removeClass("reco").addClass("reco-ed"),f=c.siblings("div").find(".blogTitle a").attr("href"),e=c.siblings("div").find(".blogTitle a").attr("data-blog_id"),$.get("/apis/community/user/blog.json?blog_id="+e,function(a){a.ok&&a.result.length>0&&a.result[0]?(d={title:a.result[0].title||c.siblings("div").find(".blogTitle h2").html(),url:a.result[0].url||f,image:"",summary:a.result[0].summary||c.siblings("div").find(".blogCont").html()},g(c,d)):(c.attr("title","推荐"),c.removeClass("reco-ed").addClass("reco"),console.error("出错了！日志返回数据有误～"))},"json"))})},unlogin:function(){},all:function(){$("#readMore").click(function(){var a=$(this);$.get("/apis/daily/blog.json?offset="+current_offset+"&limit=10&retrieve_type=by_recommend&ukey="+ukey,function(b){if(b.ok){var d=b.result;for(var e=0;e<d.length;e++){var f=d[e],g=c("blogTmpl",f);$("#blogList").append(g)}current_offset=b.offset+b.limit,current_offset>=b.total&&a.hide()}},"json")}),$.get("/apis/flowingboard/flowingboard.json?name=blog_event",function(a){var b,c='<div class="blog-event"><span> 一起来参加日志活动：</span>';if(a.ok&&a.result.length>0&&a.result[0].items.length>0){b=a.result[0].items;for(var d in b)b[d].url&&b[d].url!=""&&b[d].title&&b[d].title!=""&&(c+='<a href="'+b[d].url+'" title="'+b[d].title+'" target="_blank">'+b[d].title+"</a>");$(".gside").prepend(c)}},"json")}}}),G.def("bdShare",function(){var a='分享到：                            <a data-cmd="douban" class="gicon-share-db" href="#" title="分享到豆瓣">豆瓣</a>                            <a data-cmd="tsina" class="gicon-share-sina" href="#" title="分享到新浪微博">新浪微博</a>                            <a data-cmd="qzone" class="gicon-share-qzone" href="#" title="分享到QQ空间">QQ空间</a>                            <a data-cmd="weixin" class="gicon-share-weixin" href="#" title="分享到微信">微信</a>                            <a data-cmd="tqq" class="gicon-share-qqmb" href="#" title="分享到腾讯微博">腾讯微博</a>                            <div class="counter"><b><s></s></b><span class="bds_count share_counter" data-cmd="count"></span></div>',b;return function(c,d){b=$(c);var e=d||a;b.html(e)}}),G.def("screenTop",["support","scrollTo"],function(a,b){function i(){var b=f.height();if(g>b*2){a.fixed()||c.css("top",g+b-h);if(e)return;d||(c.appendTo("body"),h+=c.outerHeight(),d=!0),c.show(),e=!0}else e&&(c.hide(),e=!1)}"use strict";var c=$('<a class="gui-screen-top" href="#"><s></s><b></b>返回顶部</a>'),d=!1,e=!1,f=$(window),g,h;return a.fixed()||c.css("bottom","auto"),function(d){a.fixed()||(h=d||80),f.scroll(function(){g=f.scrollTop(),setTimeout(i)}),g=f.scrollTop(),c.click(function(a){a.preventDefault(),b(0)}),i()}}),G.def("UBB",function(){function p(a){this.setting=p.mix({defaultColor:"#333333",linkDefaultColor:"#006699",flashImage:"/skin/imgs/flash.png"},a),this.setting.tags=p.mix(g,this.setting.tags),this.setting.ubbTagsOrder={},this.setting.wrapUbbTags={};var b,c,d,e,f,h;a=this.setting;for(b in a.tags){c=a.tags[b];if(c==null){delete a.tags[b];continue}switch(c.canContains){case"*":a.ubbTagsOrder[b]=!0;break;case"":a.ubbTagsOrder[b]=!1;break;case undefined:a.ubbTagsOrder[b]=!1;break;default:f=c.canContains.split(","),h={};for(d=0,e=f.length;d<e;d++)h[f[d].toLowerCase()]=!0;a.ubbTagsOrder[b]=h}a.wrapUbbTags[b]=c.canWrap}}"use strict";var a={clone:function(b,c){c||(c=b,b=this);if(!b.isNode)return null;if(c){var d,e,f=b.clone();for(d=0,e=b.length;d<e;d++)b[d].isNode&&f.append(b[d].clone(!0));return f}return a.createNode(b.name,b.attr)},append:function(a,b){b||(b=a,a=this);if(!b)return a;if(b.parent)throw"Node "+b.name+" has a parent node!";return a.push(b),b.parent=a,a},getDeepestChild:function(a){var b;while(b=a[a.length-1])a=b;return a},createNode:function(b,c){var d=[];return d.isNode=!0,d.append=a.append,d.clone=a.clone,b&&(d.name=b),c&&(d.attr=c),d},createTextNode:function(b){var c=a.createNode("#text");return c.value=b,c.origValue=b,c}},b=/([A-Z])/g,c=/-([a-z])/g,d=/^-?\d/,e=/^-?\d+(?:px)?$/i,f=/\[(\/)?([a-zA-Z0-9]+)/,g={},h={block:1,table:1,"table-caption":1,"table-footer-group":1,"table-header-group":1,"table-row":1,"table-row-group":1,"list-item":1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},i={img:1,object:1,button:1,textarea:1,input:1,select:1},j={pre:1,"pre-wrap":1,"pre-line":1},k={pre:1,"pre-wrap":1},l={isInlineBlock:function(a,b){var c=l.getComputedStyle(a,"display");return!!(c==="inline-block"||c==="inline"&&i[b])},hasBlockBox:function(a){return!!h[l.getComputedStyle(a,"display")]},isKeepNewLine:function(a,b){return b==="pre"||b==="textarea"?2:j[l.getComputedStyle(a,"white-space")]?1:0},isKeepWhiteSpace:function(a){return!!k[l.getComputedStyle(a,"white-space")]},ubbEscape:function(a){return a},changeState:function(a,b,c){var d=a.node,e=a.key,f,g={0:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},1:{1:0,2:0,3:1,4:0,7:0,8:0},2:{1:1,2:1,3:1,4:0,7:1,8:1},3:{1:1,2:1,3:1,4:0,7:1,8:1}},h={1:1,2:2,3:3,5:2,6:1,7:2,8:2};f=g[e][b],f&&d&&(d.suffix=(d.suffix||"")+(f==1?"\n":"\n\n")),b in h&&(a.key=h[b]),a.node=c},parseNode:function(a,b,c,d,e,f){var g,h,i,j,k,m,n,o=f.boxStates,p=f.textStates,q=o[o.length-1],r=p[p.length-1];switch(c){case 8:return;case 3:i=a.nodeValue.replace(/\r\n/g,"\n"),j=r.keepNewLine,k=r.keepWhiteSpace,j||(i=i.replace(/^\n|\n$/g,"").replace(/\n/g," ")),k||(i=i.replace(/^[\u0020\u200B\u200A\u3000\u2000]*|[\u0020\u200B\u200A\u3000\u2000]*$/g,"").replace(/[\u0020\u200B\u200A\u3000\u2000\u00A0]{1,}/g," ")),i=l.ubbEscape(i);if(i==="")return;m=j===2&&i.slice(0,1)==="\n"&&q.key===0,n=j&&i.length>1&&i.slice(-1)==="\n",k?i==="\n"?(e.text="",m?l.changeState(q,6,e):l.changeState(q,8,e)):m&&n?(e.text=i.slice(1,-1),l.changeState(q,5,e)):m?(e.text=i.slice(1),l.changeState(q,6,e)):n?(e.text=i.slice(0,-1),l.changeState(q,7,e)):(e.text=i,l.changeState(q,1,e)):(e.text=i,l.changeState(q,1,e));break;case 1:b==="br"?l.changeState(q,2,e):e.hasBlockBox?a.offsetHeight>0?l.changeState(q,3,e):l.changeState(q,2,e):l.changeState(q,l.isInlineBlock(a,b)?1:4,e);break;default:}for(g in d.tags)h=d.tags[g],h.parseHTML&&h.parseHTML(b,a,e,d);return e},treeToUbb:function(a){var b,c,d,e=[a.prefix||""];a.text&&e.push(a.text);for(b=0,c=a.length;b<c;b++)d=a[b],e.push(l.treeToUbb(d));return e.push(a.suffix||""),e.join("")},canContains:function(a,b,c){var d=c[a.name];return typeof d=="boolean"?d:d[b.name]},pushOpenUbbTag:function(b,c,d){var e;while(!b.isRoot&&!l.canContains(b,c,d))e?e=b.clone().append(e):e=b.clone(),b=b.parent;return b.append(c),e&&l.canContains(c,e,d)?(c.append(e),a.getDeepestChild(e)):c},pushCloseUbbTag:function(b,c){var d;while(!b.isRoot&&b.name!==c)d?d=b.clone().append(d):d=b.clone(),b=b.parent;return b.isRoot?b:(b=b.parent,b.append(d),d?a.getDeepestChild(d):b)},pushLineUbbTag:function(b,c){var d;while(!b.isRoot&&!c[b.name])d?d=b.clone().append(d):d=b.clone(),b=b.parent;return b.append(a.createTextNode("\n")),b.append(d),d?a.getDeepestChild(d):b},htmlEncode:function(a){return a&&(a=a.replace(/&/igm,"&amp;"),a=a.replace(/</igm,"&lt;"),a=a.replace(/>/igm,"&gt;"),a=a.replace(/\"/igm,"&quot;")),a},scanUbbText:function(b,c,d){var e=[],g=[],h=/\[\/?(bold|italic|url|blockquote|ul|ol|image|float|ref|math|code|video|indent|h1|h2|h3|h4|h5|h6)/,i=/\[\/?(blockquote|indent|color)/,j=/\[color\S*?\]/,k=/\[\/color\]/,m=/\[\/(bold|italic|url|image|float)\]$/,n=/\[float\s*?=\s*?(right|left|none)\]/,o=/\[(ul|ol)\S*?\]/,p=/\[\/(ul|ol)\]/,q,r,s=!1;if(d&&b!==""){b=l.htmlEncode(b),e=b.split("\n"),q=e.length;for(var t=0;t<q;t++)r=e[t],h.test(r)?(i.test(r)?(r=r.replace(j,"<p>").replace(k,"</p>"),/\[indent\]/.test(r)?r=r.replace("[indent]","[indent]<p>")+"</p>":/\[\/indent\]/.test(r)&&(r="<p>"+r.replace("[/indent]","</p>[/indent]")),n.test(r)&&(r=r.replace("[/image]","__float__"+n.exec(r)[1]+"[/image]"),r=r.replace(/\[\/?float=?\w*?\]/g,""))):m.test(r)?n.test(r)?(r=r.replace("[/image]","__float__"+n.exec(r)[1]+"[/image]"),r=r.replace(/\[\/?float=?\w*?\]/g,""),r="<p>"+r+"</p>"):r="<p>"+r+"</p>":o.test(r)?(r+="\n",s=!0):p.test(r)?(r+="\n",s=!1):r+="\n",g.push(r)):s?g.push("<p>"+r+"</p>\n"):g.push("<p>"+r+"</p>");b=g.join("")}b=b.replace(/\r\n/g,"\n");var u,v,w,x,y,z,A,B=c.ubbTagsOrder,C=c.wrapUbbTags,D=0,E=1,F=D,G=0,H=0,t=b.length,I="",J=a.createNode(),K=J;J.isRoot=!0;for(;H<t;H++){u=b.charAt(H);switch(u){case"[":F===E?(I+="[",F=D):(I&&K.append(a.createTextNode(I)),I="[");break;case"]":F===E?(I+="]",F=D):(v=f.exec(I),v&&v[2]&&(w=v[2].toLowerCase())in B?(A=!!v[1],A||(z=I.slice(v[2].length+(v[1]?2:1)),x=a.createNode(w,z)),A?K=l.pushCloseUbbTag(K,w):K=l.pushOpenUbbTag(K,x,B)):K.append(a.createTextNode(I+"]")),I="");break;case"\n":F===E&&(F=D),I&&(K.append(a.createTextNode(I)),I=""),K=l.pushLineUbbTag(K,C);break;default:F===E&&(F=D),I+=u}}return I&&K.append(a.createTextNode(I)),J},parseUbbNode:function(a,b,c,d){var e=c.tags,f;if(a.name==="#text")return a.value==="\n"?d.nobr?(d.nobr=!1,""):"<br/>":(d.nobr=!1,a.value.replace(/\s/g,"&nbsp;"));if((f=e[a.name])&&f.parseUBB)return f.isBlock&&(d.nobr=!0),f.parseUBB(a,b,c)},fixUbbNode:function(a,b,c){return a.name==="#text"?l.ubbEscape(a.value):"["+a.name+(a.attr||"")+"]"+b+"[/"+a.name+"]"}},m=function(b,c,d,e){var f,g,h,i,j,k=a.createNode(),n=b.nodeType,o=b.nodeName.toLowerCase(),p=b.childNodes;d||(d={},d.boxStates=[],d.textStates=[]),n===1&&(l.hasBlockBox(b)?(d.boxStates.push({key:0,node:null}),k.hasBlockBox=!0):b.nodeName.toLowerCase()==="body"&&(d.boxStates.push({key:0,node:null}),k.hasBlockBox=!0),d.textStates.push({keepNewLine:l.isKeepNewLine(b,o),keepWhiteSpace:l.isKeepNewLine(b)}));for(f=0,g=p.length;f<g;f++)j=m(p[f],c,d,!0),j&&k.append(j);return n===1&&d.textStates.pop(),k.hasBlockBox&&d.boxStates.pop(),e?l.parseNode(b,o,n,c,k,d):l.treeToUbb(k)},n=function(a,b,c){var d,e,f=[];c=c||{};if(a.isNode)for(d=0,e=a.length;d<e;d++)f.push(n(a[d],b,c));return a.isRoot?f.join(""):l.parseUbbNode(a,f.join(""),b,c)},o=function(a,b,c){var d,e,f=[];c=c||{};if(a.isNode)for(d=0,e=a.length;d<e;d++)f.push(o(a[d],b,c));return a.isRoot?f.join(""):l.fixUbbNode(a,f.join(""),b,c)};return document.defaultView&&document.defaultView.getComputedStyle?l.getComputedStyle=function(a,c){var d,e,f=a.ownerDocument.defaultView;if(!f)return;return c=c.replace(b,"-$1").toLowerCase(),d=f.getComputedStyle(a,null),d&&(e=d.getPropertyValue(c)),e}:l.getComputedStyle=function(a,b){b=b.replace(c,function(a){return a.charAt(1).toUpperCase()});var f,g,h=a.currentStyle&&a.currentStyle[b],i=a.style;return!e.test(h)&&d.test(h)&&(f=i.left,g=a.runtimeStyle.left,a.runtimeStyle.left=a.currentStyle.left,i.left=b==="fontSize"?"1em":h||0,h=i.pixelLeft+"px",i.left=f,a.runtimeStyle.left=g),h===""?"auto":h.toString()},p.extend=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},p.addTags=function(a){p.extend(g,a)},p.mix=function(a,b){var c,d={};return p.extend(d,a),p.extend(d,b),d},p.Util=l,p.prototype.HTMLtoUBB=function(a){return this.fixUBB(m(a,this.setting))},p.prototype.UBBtoHTML=function(a){return n(l.scanUbbText(a,this.setting,!0),this.setting)},p.prototype.fixUBB=function(a){var b=o(l.scanUbbText(a,this.setting),this.setting);return b},p.prototype.escapeUBB=l.ubbEscape,p.extend(p.Util,{isBold:function(a){var b=parseInt(a,10);return isNaN(b)?/^(bold|bolder)$/.test(a):b>400},isItalic:function(a){return/^(italic|oblique)$/.test(a)},RGBtoHEX:function(a){var b,c="",d,e=/([0-9]+)[, ]+([0-9]+)[, ]+([0-9]+)/,f=e.exec(a);if(!f)if(a.length===4){d=a.split("").slice(1),c="#";for(b=0;b<3;b++)c+=d[b]+d[b]}else c=a;else{for(b=1;b<f.length;b++)c+=("0"+parseInt(f[b],10).toString(16)).slice(-2);c="#"+c}return c}}),p.addTags({bold:{parseHTML:function(a,b,c){a==="#text"&&l.isBold(l.getComputedStyle(b.parentNode,"font-weight"))&&(c.prefix="[bold]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/bold]")},parseUBB:function(a,b,c){return"<b>"+b+"</b>"},canContains:"bold,italic,color,url,image,float",canWrap:0,isBlock:0,noAttr:1},italic:{parseHTML:function(a,b,c){a==="#text"&&l.isItalic(l.getComputedStyle(b.parentNode,"font-style"))&&(c.prefix="[italic]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/italic]")},parseUBB:function(a,b,c){return"<i>"+b+"</i>"},canContains:"bold,italic,color,url,image,float",canWrap:0,isBlock:0,noAttr:1},color:{parseHTML:function(a,b,c,d){if(a==="#text"){var e,f=b.parentNode;e=l.RGBtoHEX(l.getComputedStyle(f,"color")),e&&e!==d.defaultColor&&(f.nodeName.toLowerCase()!=="a"||e!==d.linkDefaultColor)&&(c.prefix="[color="+e+"]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/color]")}},parseUBB:function(a,b,c){return'<span style="color:'+(a.attr?a.attr.slice(1):"")+';">'+b+"</span>"},canContains:"bold,italic,color,url,image,float",canWrap:0,isBlock:0,noAttr:0},url:{parseHTML:function(a,b,c){a==="a"&&(c.prefix="[url="+b.getAttribute("href")+"]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/url]")},parseUBB:function(a,b,c){var d,e,f,g=a.attr?a.attr.replace(/^\ href\=|^\=+/,""):"";if(!a.attr)for(d=0,f=a.length;d<f;d++)e=a[d],e.name==="#text"&&(g+=e.value);return'<a href="'+g+'">'+b+"</a>"},canContains:"bold,italic,color,url,image,float",canWrap:0,isBlock:0,noAttr:0},image:{parseHTML:function(a,b,c){if(a==="img"&&!b.getAttribute("data-src")&&!b.getAttribute("data-code")){var d;b.getAttribute("style")&&/float/.test(b.getAttribute("style"))?(d=b.getAttribute("style").split("float")[1],d=d.match(/right|left|none/)[0],d==="none"?c.prefix="[image]"+b.getAttribute("src")+"[/image]"+(c.prefix||""):c.prefix="[float="+d+"][image]"+b.getAttribute("src")+"[/image][/float]"+(c.prefix||"")):c.prefix="[image]"+b.getAttribute("src")+"[/image]"+(c.prefix||"")}},parseUBB:function(a,b,c){return/__float__/.test(b)?(b=b.split("__float__"),b?'<img src="'+b[0]+'" style="float:'+b[1]+'"/>':""):b?'<img src="'+b+'"/>':""},canWrap:0,isBlock:0,noAttr:1},video:{parseHTML:function(a,b,c){var d;a==="img"&&(d=b.getAttribute("data-src"))&&(c.prefix="[video]"+d+"[/video]"+(c.prefix||""))},parseUBB:function(a,b,c){return b?'<img class="gui-ubb-flash" data-src="'+b+'" src="'+c.flashImage+'" width="480" height="400"/>':""},canWrap:0,isBlock:0,noAttr:1},math:{parseHTML:function(a,b,c){var d;a==="img"&&(d=b.getAttribute("data-code"))&&(c.prefix="[math]"+d+"[/math]"+(c.prefix||""))},parseUBB:function(a,b,c){var d=a[0].origValue,e;return $.ajax({url:"/apis/formula.json",type:"post",async:!1,data:{tex:d},success:function(a){e=a.result.url},dataType:"json"}),b?'<img data-code="'+d.replace('"','\\"')+'" src="'+e+'" class="edui-faked-insertmathjax"/>':""},canWrap:0,isBlock:0,noAttr:1},flash:{parseUBB:function(a,b,c){return b?'<img class="gui-ubb-flash" data-src="'+b+'" src="'+c.flashImage+'" width="480" height="400"/>':""},canWrap:0,isBlock:0,noAttr:1},blockquote:{parseHTML:function(a,b,c){a==="blockquote"&&(c.prefix="[blockquote]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/blockquote]")},parseUBB:function(a,b,c){return"<blockquote>"+b+"</blockquote>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},indent:{parseHTML:function(a,b,c){a==="dl"&&(c.prefix="[indent]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/indent]")},parseUBB:function(a,b,c){return"<dl>"+b+"</dl>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},h1:{parseHTML:function(a,b,c){a==="h1"&&(c.prefix="[h1]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/h1]")},parseUBB:function(a,b,c){return"<h1>"+b+"</h1>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},h2:{parseHTML:function(a,b,c){a==="h2"&&(c.prefix="[h2]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/h2]")},parseUBB:function(a,b,c){return"<h2>"+b+"</h2>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},h3:{parseHTML:function(a,b,c){a==="h3"&&(c.prefix="[h3]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/h3]")},parseUBB:function(a,b,c){return"<h3>"+b+"</h3>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},h4:{parseHTML:function(a,b,c){a==="h4"&&(c.prefix="[h4]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/h4]")},parseUBB:function(a,b,c){return"<h4>"+b+"</h4>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},h5:{parseHTML:function(a,b,c){a==="h5"&&(c.prefix="[h5]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/h5]")},parseUBB:function(a,b,c){return"<h5>"+b+"</h5>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},h6:{parseHTML:function(a,b,c){a==="h6"&&(c.prefix="[h6]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/h6]")},parseUBB:function(a,b,c){return"<h6>"+b+"</h6>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},code:{parseHTML:function(a,b,c){a==="pre"&&(c.prefix="[code]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/code]")},parseUBB:function(a,b,c){return"<pre>"+b+"</pre>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},ul:{parseHTML:function(a,b,c){a==="ul"&&(c.prefix="[ul]\n"+(c.prefix||""),c.suffix=(c.suffix||"")+"\n[/ul]")},parseUBB:function(a,b,c){var d=0,e=b.split("<br/>"),f=e[0]?0:1,g=e[e.length-1]?0:-1,h=[];g+=e.length;for(;f<g;d++,f++)h[d]=e[f];return"<ul><li>"+h.join("</li><li>")+"</li></ul>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},ol:{parseHTML:function(a,b,c){a==="ol"&&(c.prefix="[ol]\n"+(c.prefix||""),c.suffix=(c.suffix||"")+"\n[/ol]")},parseUBB:function(a,b,c){var d=0,e=b.split("<br/>"),f=e[0]?0:1,g=e[e.length-1]?0:-1,h=[];g+=e.length;for(;f<g;d++,f++)h[d]=e[f];return"<ol><li>"+h.join("</li><li>")+"</li></ol>"},canContains:"*",canWrap:1,isBlock:1,noAttr:1},ref:{parseHTML:function(a,b,c){a==="div"&&b.className==="gui-ubb-ref"&&(c.prefix="[ref]"+(c.prefix||""),c.suffix=(c.suffix||"")+"[/ref]")},parseUBB:function(a,b,c){return'<div class="gui-ubb-ref">'+b+"</div>"},canWrap:0,isBlock:1,noAttr:1}}),p}),G.def("./censor/report",["Overlay","tmpl"],function(a,b){function d(){var a=$("#reportReasons").find(":checked").next(),b=a.next(),c=b.length?b.val():a.text();return c}function e(a,b,e,f,g){function h(b){b.preventDefault();var e=d();if(!e){alert("请填写举报理由");return}if(e.length<2){alert("多写几个字又不会怀孕");return}if(e.length>140){alert("删除理由不能超过100个字");return}f(a,e,function(){c.close(),g()})}c.open(e,[{event:"click",selector:"#reportSure",func:h},{event:"click",selector:"#reportCancel",func:function(a){a.preventDefault(),c.close()}}]),c.title(b)}function h(a,c,d){if(a.attr("data-report")!="yes")return;var h=a.attr("data-url"),i=a.attr("data-type"),j=a.attr("data-title"),k=a.attr("data-img"),l={url:h,type:i,img:k,title:j},m=b(f,l),n="举报"+i;e(h,n,m,g.reportAdmin,function(){a.text("举报成功"),a.attr("data-report","no")})}var c=new a,f='<div class="block-report-content">                         <% if (img) { %>                         <img src="<%=img%>" width="48" height="48"/>                         <% } %>                         <% if (title) { %>                             <a href="<%=url%>" target="_blank"><%=title%></a>                         <% } %>                     </div>                     <div class="block-report-reasons">                         <h5>举报理由：</h5>                         <ul id="reportReasons">                             <li><input type="radio" id="reason1" name="reason" /><label for="reason1">垃圾广告</label></li>                             <li><input type="radio" id="reason2" name="reason"/><label for="reason2">敏感或淫秽色情信息</label></li>                             <li><input type="radio" id="reason3" name="reason"/><label for="reason3">人身攻击</label></li>                             <li><input type="radio" id="reason4" name="reason"/><label for="reason4">内容涉及抄袭及版权问题</label></li>                             <li class="block-report-reasons-o"><input type="radio" id="reason5" name="reason"/><label for="reason5">其他理由</label><input type="text" class="block-report-reasons-txt"/></li>                         </ul>                     </div>                     <div class="block-report-do">                         <a href="#" id="reportSure">提交</a><a href="#" id="reportCancel">取消</a>                     </div>',g={reportAdmin:function(a,b,c){$.post("/apis/censor/report.json",{url:a,reason:b},c)}};return h}),G.def("Select",function(){var a=!1;return Select=function(a,b,c,d){this.selectId=a,this.optTmp=b||'<li><a href="javascript: void 0;" optId="{optionId}">{optName}</a></li>',this.option=c,this.callBack=d,this.init()},Select.prototype={constructor:Select,init:function(){this.buildSelect(),this.bindHover(),this.bindClick(),this.setOptions()},buildSelect:function(){var a=this,b=a.option,c=b.length,d="",e=$("#"+a.selectId);e.append('<ul class="options"></ul>');for(var f=0;f<c;f++)d+=a.optTmp.replace("{optionId}",b[f].id).replace("{optName}",b[f].name);e.find(".options").html(d)},bindHover:function(){$(document).delegate(".gselect","hover",function(){$(this).css({cursor:"pointer"})})},bindClick:function(){var b=this;$("#"+b.selectId).delegate(".gselect-box","click",function(){var c=$("#"+b.selectId),d=c.find(".options"),e=d.css("display");return e=="none"?(a&&$(".options").hide(),d.css("display","block"),a=!0):(d.css("display","none"),a=!1),!1}),$("body").click(function(){if(a)return $(".options").hide(),a=!1,!1})},setOptions:function(){var a=this,b=$("#"+a.selectId);b.delegate(".options li a","click",function(){a.setOption($(this)),a.callBack($(this))}),a.setOption(b.find(".options li:eq(0) a"))},setOption:function(a){var b=this,c=$("#"+b.selectId),d=a.html(),e=c.find(".gselected");e.html(d),c.find("ul a").removeClass("select-act"),a.addClass("select-act")}},Select}),G.def("Basket",["Overlay","Select"],function(a,b){var c=function(c){var d={};return d={template:{newBasket:'<div class="new-basket-box">                                <label for="basketTitle">                                    标题<span class="new-basket-tip">（必填）</span>                                </label>                                <input id="basketTitle" />                                <label for="basketDescrip">描述</label>                                <textarea id="basketDescrip"></textarea>                                <label for="basketCategory">分类</label>                                <div id="basketCategory" class="gselect">                                    <div class="gselect-box">                                        <span class="gselected">选择类别</span>                                        <b class="gnarrow-down"></b>                                    </div>                                </div>                                <span class="basket-form-tip" id="basketCategoryTip"></span>                                <div class="gclear">                                    <a href="javascript:void 0;" class="gbtn gfr" id="createOkBtn">确定</a>                                </div>                            </div>',firstBasket:'<div class="first-basket-box"><a class="first-basket-tip" id="createFirstBlock"><span class="first-basket-add"><span class="first-basket-add-top"></span><span class="first-basket-add-mid"></span><span class="first-basket-add-btm"></span></span>创建一个果篮，把你喜欢的内容收集进来吧。</a><div class="first-basket-btns"><a href="javascript:void 0;" id="createFirstBtn" class="gfr gbtn">创建</a><a href="javascript:void 0;" class="blockClose gfr">取消</a></div></div>',basketList:'<div class="basket-box" id="basketBox"><ul class="baskets">{baskets}</ul><div class="basket-box-footer gclear"><a href="javascript:void 0;" id="createBasketBtn" class="gfl">创建新果篮</a><a href="javascript:void 0;" class="gfr gbtn blockClose">确定</a></div></div>',basketLi:'<li{adClas} data-basket_id="{basketId}"><span class="gfr">{operationTxt}</span><p class="gellipsis">{basketName}</p></li>',addedTag:'<span data-operation="delBasket">已添加</span>',addTag:'<a href="javascript:void 0;" data-operation="addBasket">+ 添加</a>',delTag:'<a href="javascript:void 0;" data-operation="delBasket">- 扔掉</a>'},apis:{basketApi:"/apis/favorite/basket.json",fruitApi:"/apis/favorite/link.json",categoryApi:"/apis/favorite/category.json"},ukey:ukey,fruitUrl:"",btitle:"",defaultOpts:{isCreateBasket:!1,createCallBack:function(a){},delLinkCallBack:function(a){a.parents("li").removeClass("added"),a.replaceWith(d.template.addTag)}},opt:function(){return $.extend({},this.defaultOpts,c)},add:function(a){var b=this,c=a;b.fruitUrl=c.attr("data-url"),b.btitle=c.attr("data-title"),b.getBasket()},del:function(a){var b=g_uid,c=this;$.ajax({url:c.apis.basketApi,type:"delete",data:{basket_id:a},success:function(a){window.location="/i/"+b+"/baskets/"},dataType:"json"})},getLinkInfo:function(a){var b=this;$.ajax({url:"/apis/favorite/link.json",type:"get",data:{ukey:b.ukey,url:b.fruitUrl,retrieve_type:"by_url"},success:function(c){var d=c.result;if(a){for(var e=0;e<d.baskets.length;e++){var f=d.baskets[e].id;for(var g=0;g<a.length;g++)if(a[g].id==f){a[g].contained_fruit=!0;break}}b.showBaskets(a)}},error:function(c){var d=$.parseJSON(c.responseText);d.error_code===200015&&b.showBaskets(a)},dataType:"json"})},getBasket:function(){var a=this;ukey&&$.ajax({url:a.apis.basketApi+"?t="+(new Date).getTime(),type:"get",data:{retrieve_type:"by_ukey",ukey:a.ukey,limit:100},success:function(b){var c=b.result;c.length==0?a.createFirstBasket():a.getLinkInfo(c)},dataType:"json"})},fruitAdd:function(a,b){var c=this;$.ajax({url:c.apis.fruitApi,type:"POST",data:{basket_id:a,url:c.fruitUrl,title:c.btitle},success:function(a){b.parents("li").addClass("added"),b.replaceWith(c.template.addedTag)},dataType:"json"})},fruitDel:function(a,b,c){var d=this,c=c||d.fruitUrl;$.ajax({url:d.apis.fruitApi,type:"delete",data:{basket_id:a,url:c},success:function(a){d.opt().delLinkCallBack(b)},dataType:"json"})},createFirstBasket:function(){var b=new a,c=this;b.open(c.template.firstBasket,null,function(){b.title("创建新果篮"),b.width(432),$(".first-basket-box").delegate("#createFirstBlock","click",function(){c.createBasket()}),$(".first-basket-box").delegate("#createFirstBtn","click",function(){c.createBasket()})})},basketSend:function(a,b,c,d){var e=this;$.ajax({url:e.apis.basketApi,type:"post",data:{title:a,introduction:b,category_id:c},success:function(a){var b=a;e.opt().isCreateBasket?(d.close(),e.opt().createCallBack(b)):e.getBasket()},error:function(a){var b=$.parseJSON(a.responseText);b.error_code===243043?alert("您已经创建过同名果篮"):b.error_code===243045&&alert("您已经超过了可创建果篮的最大限制")},dataType:"json"})},getCategory:function(){var a=this;$.ajax({url:a.apis.categoryApi,type:"GET",success:function(b){var c=b.result;c.unshift({id:"-1",name:"选择类别"}),a.createBasketBlock(c)},dataType:"json"})},createBasket:function(){var a=this;a.getCategory()},createBasketBlock:function(c){var d=new a,e=this;d.open(e.template.newBasket,null,function(){d.title("创建新果篮"),d.width(432);var a='<li><a href="javascript: void 0;" data-category="{optionId}">{optName}</a></li>',f=new b("basketCategory",a,c,function(){});$(".new-basket-box").delegate("#createOkBtn","click",function(){var a=$("#basketTitle").val(),b=$("#basketDescrip").val(),c=$("#basketCategory .options .select-act").data("category");if(a===""){$("#basketTitle").css("border-color","red");return}e.basketSend(a,b,c,d)})})},showBaskets:function(b){var c=new a,d=this,e="",f="",g=b,h=g.length,i,j="";for(var k=0;k<h;k++)i=g[k],adClas=i.contained_fruit?' class="added"':"",j=i.contained_fruit?d.template.addedTag:d.template.addTag,e+=d.template.basketLi.replace("{adClas}",adClas).replace("{basketId}",i.id).replace("{basketName}",i.title).replace("{operationTxt}",j);f=d.template.basketList.replace("{baskets}",e),c.open(f,null,function(){c.title("添加到果篮"),c.width(432),$("#basketBox").delegate(".added","mouseenter",function(){$(this).find(".gfr").html(d.template.delTag)}),$("#basketBox").delegate(".added","mouseleave",function(){$(this).find(".gfr").html(d.template.addedTag)}),$("#basketBox").delegate("[data-operation]","click",function(){var a=$(this),b=a.attr("data-operation"),c=a.parents("li").attr("data-basket_id");if(b=="addBasket")d.fruitAdd(c,a);else if(b=="delBasket")d.fruitDel(c,a);else return}),$("#basketBox").delegate("#createBasketBtn","click",function(){d.createBasket()})})}}};return c}),G.def("./blog/newContentPage",["../lib/bdShare","../lib/screenTop","../lib/scrollTo","../lib/placeholder","../lib/Overlay","../lib/UBB","../lib/tmpl","../lib/AliasUtils","../lib/Recommend","../lib/draftNew","../lib/ValidateUtils","../lib/validate","../censor/report","../lib/Basket","../lib/Count","../lib/toolTip","../lib/at"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function C(a,b){a.doOnce(function(){this.delegate("a[data-operation]","click",function(a){a.preventDefault();var c=$(this);c.data("operation")===b&&confirm("确定删除这条评论？")&&A.deleteComment(c.data("id"),function(){c.closest("li").fadeOut()})})})}function D(a,b){if(b){var d,e="",f=b.dom,g=b.selection,h=a.parent();h.prev().find(">:not(blockquote)").each(function(){e+=$(this).text()+" ";if(e.length>100)return e=e.substring(0,100)+"...",!1}),g.setContent(["<blockquote>引用@",h.siblings(".cmtAuthor").text()," 的话：",tinymce.html.Entities.encodeRaw(e),"</blockquote>"].join("")),d=g.getEnd(),d&&d.tagName==="BLOCKQUOTE"&&g.setContent(" "),c($(w)),b.focus()}else c($(w))}function E(a,b){var c=$("#replyAlsoReco");a.submit(function(c){var d=this,e=$("#captcha");if(d.sign===!0)return!1;d.sign=!0;var f=b.dom.doc.body.innerText!=null?b.dom.doc.body.innerText:b.dom.doc.body.textContent,g=f.trim().length,h;if(!b.getContent().trim())return alert("请填写内容"),d.sign=!1,!1;if(g>3e3)return alert("回应内容不能超过3000字"),d.sign=!1,!1;h=G.unique(f.match(x));if(h&&h.length>20)return alert("对不起，不能@超过20个人"),d.sign=!1,!1;if(e.length&&e.attr("type")==="text"&&!e.val())return alert("验证码不能为空"),d.sign=!1,!1;a.find("textarea").val(function(){return b.getContent()})})}"use strict";var r=g_obj_id,s="article",t=$("#comments"),u="#replyForm",v="reply",w="#commentsReplyer",x=/@[\u3400-\u4db5\u4e00-\u9fcba-zA-Z0-9\._\-]+/g,y=!1,z="",A={deleteComment:function(a,b){$.ajax({url:"/apis/daily/blog/reply.json",data:{reply_id:a},type:"DELETE",success:function(a){a.ok&&b&&b()},dataType:"json"})}},B=new f({tags:{image:null,video:null,flash:null,blockquote:{parseHTML:function(a,b,c){var d=c.pop();while(d)d=c.pop()}},url:null,color:null,ref:null}});return{login:function(a){function w(){function d(){if(tinyMCE.activeEditor)return a=tinyMCE.activeEditor,E(c,a),!0;setTimeout(d,100)}function e(){a&&a.initialized?(z==="replyQuote"&&D(s,a),setTimeout(function(){t.delegate("a[data-operation=quoteComment]","click",function(){D($(this),a)})},1e3),y=!0):setTimeout(e,1e3)}function g(a,b){p.html('<i class="gicon-draft-save"></i>正在保存').css("visibility","visible"),$.ajax({url:"/apis/community/draft.json",type:"post",data:a,success:function(a){a.ok&&b&&(k=a.result.id,b())},dataType:"json"})}function h(){p.html('<i class="gicon-draft-save"></i>已保存').css("visibility","visible").hover(function(){$(this).html('<i class="gicon-draft-del"></i>删除草稿')},function(){$(this).html('<i class="gicon-draft-save"></i>已保存')}).click(function(b){l&&confirm("确定要删除草稿并清空编辑框吗？")&&(l=!1,$.ajax({url:"/apis/community/draft.json",type:"delete",data:{ids:k},success:function(b){a.setContent(""),l=!0},dataType:"json"}),$(this).css("visibility","hidden"))})}function i(){f=j(tinyMCE.activeEditor,g,b),$(window).delegate("#stop","click",function(){f&&f.destory()})}var a,b={success:function(){h()},interval:2e4,$title:$("#articleTitle"),checkTitle:!1,prefix:"日志"};window.initEditor("#replyForm textarea:first",{width:650,content_css:tinymceContentCSS,submit_form_selector:"#replyForm",setup:function(a){a.on("init",function(a,b){i()})},atFunc:q}),d(),e()}function x(){if(y)return;$(".reply-box").hide(),$(".cmts-do form").show(),w()}function F(){if(a==null)return;var b,c,d,e='<span class="reco-pic"><a href="{{url}}" data-title="{{nickname}}"><img src="{{avatarUrl}}"></a></span>';$.get("/apis/community/user/"+a+".json",function(a){b=a.result.url||"javascript: void 0;",c=a.result.nickname||null,d=a.result.avatar.normal.replace("48x48","30x30")||null;if(c==null||d==null)return;e=e.replace("{{url}}",b).replace("{{nickname}}",c).replace("{{avatarUrl}}",d),$("#recoTooltip span").length===20&&$("#recoTooltip span")[19].remove(),$("#recoTooltip").prepend(e)})}var b=$("#"+v),c=$(u),d,f,k,l=!0,p=$("#draftTip"),r,s;$(".cmts-do form textarea").text()!==""?(z="draft",x()):($(".reply-box").one("click",function(){z="reply",x()}),$("a[data-operation=quoteComment]").one("click",function(a){z="replyQuote",s=$(this),x()})),C(t,"deleteComment");var B=$("#checkAlias");B.html(h.makeShareTmpl()),h.checkAlias(B),$("#recommendBt").doOnce(function(){var a=$(this);a.hasClass("recommend-ed-btn")||a.one("click",function(){var b=new i,c=g_share_data,d=$("#recomNum"),e=new o(d);c.comment=$.trim($("#recommendText").val()),c.target=["activity"],b.recommendApi(c,function(){e.add(1),a.html("已推荐"),a.removeClass("recommend-btn").addClass("recommend-ed-btn"),$("#recomNum").show(),F()})})}),$("#recoToIndex").doOnce(function(){var a=$(this),b=g_obj_id;a.click(function(){var c=a.attr("data-reco");$.ajax({url:"/apis/daily/blog/dig.json",type:c,data:{blog_id:b},success:function(b){b.ok&&(c==="post"?a.removeClass("reco").addClass("reco-ed").attr("data-reco","delete").html("已推荐"):c==="delete"?a.removeClass("reco-ed").addClass("reco").attr("data-reco","post").html("推荐出台"):console.error("页面错误刷新重试!"))},dataType:"json"})})}),$("#deleteBlog").click(function(){var a=$(this),b=g_obj_id,c=g_uid;if(!confirm("确定删除这篇日志？"))return!1;$.ajax({url:"/apis/daily/blog.json",type:"delete",data:{blog_id:b},success:function(a){window.location="/i/"+c+"/blogs/"},dataType:"json"})});if(g_is_admin){var G=new e,H=function(){var a=$("#delReasons").find(":checked").next(),b=a.next(),c=b.length?b.val():a.text();return c},I=function(a,b,c,d){function e(a){a.preventDefault();var b=H();if(!b){alert("请填写删除理由");return}if(b.length>140){alert("删除理由不能超过140个字");return}c(b,function(){G.close(),d()})}G.open(b,[{event:"click",selector:"#delSure",func:e},{event:"click",selector:"#delCancel",func:function(a){a.preventDefault(),G.close()}}]),G.title(a)},J=$("#commentsReplyer"),K="<h4>发表回应</h4><p>此帖子目前不允许回应</p>",L='<div class="block-del-content">                                                <% if (img) { %>                                                <img src="<%=img%>" width="48" height="48"/>                                                <% } %>                                                <div>                                                    <a href="<%=link%>" target="_blank"><%=name%>：</a>                                                    <p class="<%=contentClass%>"><%=content%></p>                                                </div>                                            </div>                                            <div class="block-del-reasons">                                                <h5>删除理由：</h5>                                                <ul id="delReasons">                                                    <li><input type="radio" id="reason1" name="reason" /><label for="reason1">广告、色情等违规内容</label></li>                                                    <li><input type="radio" id="reason2" name="reason"/><label for="reason2">与本文无关的内容</label></li>                                                    <li><input type="radio" id="reason3" name="reason"/><label for="reason3">不适当言论</label></li>                                                    <li><input type="radio" id="reason4" name="reason"/><label for="reason4">违反相关组规</label></li>                                                    <li class="block-del-reasons-o"><input type="radio" id="reason5" name="reason"/><label for="reason5">其他理由</label><input type="text" class="block-del-reasons-txt"/></li>                                                </ul>                                            </div>                                            <div class="block-del-do">                                                <a href="#" id="delSure">提交</a><a href="#" id="delCancel">取消</a>                                            </div>',M={adminDeleteReply:function(){var a=this,b=a.parent(),c=b.siblings(".cmtAuthor"),d=b.siblings(".cmtContent").text().replace("\n",""),e={name:c.text(),link:c.attr("href"),img:b.siblings(".cmtImg").find("img").attr("src"),content:d.length>60?d.slice(0,60)+"...":d,contentClass:""},f={deleteTitle:"删除评论"},h=g(L,e);I(f.deleteTitle,h,A.deleteReply,function(){a.closest("li").slideUp("slow")})}};$("#comments").delegate(".adminCmtDelete","click",function(a){a.preventDefault();var b=$(this),c=b.attr("data-operation"),d;d=M[c],d.call(b)})}$("#captchaImage").doOnce(function(){function e(b){b.preventDefault(),a.attr("src",c+"?v="+d++)}var a=$("#captchaImage"),b=$("#changeCaptchaImage"),c=a.attr("src"),d=1;b.click(e),a.click(e)}),$(".document-do").live("hover",function(){var a=$(this).find("a[data-report]");a.toggle(),a.next().toggle()}).delegate("a[data-report]","click",function(){m($(this))}),$("#comments ul.cmts-list >li").live("hover",function(){var a=$(this).find("a[data-report]");a.toggle(),a.next().toggle()}),$("#comments").delegate("a[data-report]","click",function(){m($(this))}),$("#basketBtn").doOnce(function(){var a=new n,b=$("#basketBtn");b.click(function(){a.add(b)})})},unlogin:function(){},all:function(){function e(){var a=$("#articleDescription").text().trim(),b=$("#articleTitle").text()||document.title,c,d=$("#authorName").length>0?$("#authorName").html():"";c={url:location.protocol+"//"+location.host+location.pathname,title:b,summary:a.length>115?a.slice(0,115)+"...":a},window._bd_share_config={share:{tag:"shareMain",bdText:c.title,bdDesc:c.summary,bdUrl:c.url,bdSign:"off",onBeforeClick:function(a,b){$.ajax({url:"/apis/web2png.json",type:"post",async:!1,data:{timestamp:(date_modified?date_modified:0)+2,url:"http://"+window.location.host+"/blog/"+g_obj_id+"/_web2png/"},success:function(a){a.ok&&a.result.url&&(b.bdPic=a.result.url)},dataType:"json"});if(a==="tsina"){var c=$("#authorXlNickname").length>0&&$("#authorXlNickname").attr("data-weibo_nickname")!=""?"@"+$("#authorXlNickname").attr("data-weibo_nickname")+" ":d;b.bdText="这个有意思 →_→【"+c+"的日志："+b.bdText+"】 （分享自 @果壳网）"}else a==="tqq"?b.bdText="这个有意思 →_→【"+d+"的日志："+b.bdText+"】 （分享自 @果壳网）":b.bdDesc="这个有意思 →_→【"+d+"的日志："+b.bdText+"】 （来自 果壳网）";return b},bdSnsKey:{tsina:"2727579136",tqq:"100246400"}}},G.loadScript("http://bdimg.share.baidu.com/static/api/js/share.js?v=86835285.js?cdnversion="+~(-(new Date)/36e5))}function f(){$("body").one("click",function(a){var b=a.target;if($(b).parent()[0].id==="share"||$(b)[0].id==="share"){f();return}$("#share").hide(),$("#shareBtn").removeClass("active")}),$("#sinaShare").one("click",function(){$("#share").hide(),$("#shareBtn").removeClass("active")})}function g(){$("body").one("click",function(a){var b=a.target;if($(b)[0].id==="recoTooltip"||$(b).parents("#recoTooltip").length>0){g();return}$("#recoTooltip").hide()})}var c=$("#submitTip");$(".submit").hover(function(){c.show()},function(){c.hide()}),b();var d='<a data-cmd="tsina" class="gicon-share-lsina" href="javascript:void 0;" title="分享到新浪微博" id="sinaShare">新浪微博</a>                                <a href="javascript: void 0;" class="share" id="shareBtn">分享</a>                                <div id="share" class="share-tooltip">                                    <p><a data-cmd="weixin" href="#" title="分享到微信"><i class="gicon-share-lweixin"></i>微信</a></p>                                    <p><a data-cmd="douban" href="#" title="分享到豆瓣"><i class="gicon-share-ldb"></i>豆瓣</a></p>                                    <p><a data-cmd="qzone" href="#" title="分享到QQ空间"><i class="gicon-share-lqzone"></i>QQ空间</a></p>                                    <p><a data-cmd="tqq" href="#" title="分享到腾讯微博"><i class="gicon-share-lqqmb"></i>腾讯微博</a></p>                                </div>';a("#shareWrap",d),$("#shareWrap").attr("data-tag","shareMain"),e(),$("#shareWrap").delegate("#shareBtn","click",function(a){a.preventDefault(),$(this).addClass("active"),$("#share").show(function(){f()})}),$("#recomNum").click(function(){$("#recoTooltip").show(1,g)});var h=null;$("#recoWrap").delegate("#recoTooltip a","mouseenter",function(){var a;h=p($(this).parent(),{msg:"<span>"+$(this).attr("data-title")+"</span>",position:[0,43],direction:"left",offset:8,zIndex:1e3,klass:"name-tooltip"})}),$("#recoWrap").delegate("#recoTooltip a","mouseleave",function(){$("#recoTooltip span").css("position","static"),h.remove()}),$("#articleContent a,.cmts-list .cmt-content a").attr("target","_blank"),$(".cmts-do .reply-box").length===0&&$("a[data-operation=quoteComment]").click(function(a){a.stopPropagation(),D(t,null)})}}});if(typeof g_page_name!="undefined"){typeof ukey=="undefined"&&(ukey="");var moduleName=g_page_name.replace(/blog/g,"");moduleName=moduleName.slice(0,1).toLowerCase()+moduleName.slice(1),G.req("./blog/"+moduleName,function(a){"use strict";if(a==null)return;var b=ukey?"login":"unlogin";a[b]&&a[b](ukey),a.all&&a.all()})}