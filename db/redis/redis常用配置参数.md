Redis的一下常见设置都是通过对redis.conf文件进行修改来完成的。
 本文主要介绍了设置访问密码、主从配置、设置数据和日志目录、以及参数调优等方面。
 
 一. 权限设置：
1. 修改redis.conf文件：


        requirepass nick123  

2. 客户端登录，需要先进行授权操作，提供密码即可。


        auth nick123  

 

 二. 主从配置：

通过设置Redis的配置文件redis.conf可以进行主从(Master-Slave)设置，可以设置一个Redis节点为Master，同时设置一个或多个Slave节点(一主多从以及多级从结构)。

主从结构，一是为了纯粹的冗余备份，二是为了提升读性能，比如很消耗性能的SORT就可以由从服务器来承担。

redis的主从同步是异步进行的，这意味着主从同步不会影响主逻辑，也不会降低redis的处理性能。

主从架构中，可以考虑关闭主服务器的数据持久化功能，只让从服务器进行持久化，这样可以提高主服务器的处理性能。

在主从架构中，从服务器通常被设置为只读模式，这样可以避免从服务器的数据被误修改。但是从服务器仍然可以接受CONFIG等指令，所以还是不应该将从服务器直接暴露到不安全的网络环境中。如果必须如此，那可以考虑给重要指令进行重命名，来避免命令被外人误执行。


从服务器会向主服务器发出SYNC指令，当主服务器接到此命令后，就会调用BGSAVE指令来创建一个子进程专门进行数据持久化工作，也就是将主服务器的数据写入RDB文件中。在数据持久化期间，主服务器将执行的写指令都缓存在内存中。

在BGSAVE指令执行完成后，主服务器会将持久化好的RDB文件发送给从服务器，从服务器接到此文件后会将其存储到磁盘上，然后再将其读取到内存中。这个动作完成后，主服务器会将这段时间缓存的写指令再以redis协议的格式发送给从服务器。

另外，要说的一点是，即使有多个从服务器同时发来SYNC指令，主服务器也只会执行一次BGSAVE，然后把持久化好的RDB文件发给多个下游。在redis2.8版本之前，如果从服务器与主服务器因某些原因断开连接的话，都会进行一次主从之间的全量的数据同步；而在2.8版本之后，redis支持了效率更高的增量同步策略，这大大降低了连接断开的恢复成本。

主服务器会在内存中维护一个缓冲区，缓冲区中存储着将要发给从服务器的内容。从服务器在与主服务器出现网络瞬断之后，从服务器会尝试再次与主服务器连接，一旦连接成功，从服务器就会把“希望同步的主服务器ID”和“希望请求的数据的偏移位置（replication offset）”发送出去。主服务器接收到这样的同步请求后，首先会验证主服务器ID是否和自己的ID匹配，其次会检查“请求的偏移位置”是否存在于自己的缓冲区中，如果两者都满足的话，主服务器就会向从服务器发送增量内容。

增量同步功能，需要服务器端支持全新的PSYNC指令。这个指令，只有在redis-2.8之后才具有。

1. 在从节点配置redis.conf即可：设置为主节点的IP和端口


        slaveof 192.168.142.12 6379  

2. 如果Master节点设置了密码，Slave节点需要同时设置： 


        masterauth nickxu  

3. 说明：
   @ 通过主从设置，可以进行读写分离：通常使用Master节点负责写数据，Slave节点负责读数据、注意Slave节点不能进行写操作。
   @ 数据备份：微笑在Slave节点执行如下命令，然后拷贝dump.rdb即可


        bgsave #该命令在后台执行，进行持久化操作，不会影响客户端的链接  
        save  #如果上述bgsave执行失败，可以使用save进行操作，但是会影响客户端的链接  

         
 三. 日志/数据目录：

1. 创建如下所示的目录：


        mkdir -p /opt/redis/logs  
        mkdir -p /opt/redis/data  

2. 对日志进行设置：


        loglevel debug                                          #日志级别：默认为notice  
        logfile /opt/redis/logs/redis.log  #日志输出：默认为stdout  

3. 设置数据目录：


        dbfilename redis.rdb                #默认为dump.rdb  
        dir /opt/redis/data                 #默认为./  

        
  四. 设置最大内存：         


        maxmemory 256mb  

        [说明]
        @ 设置Redis能够占用的最大内存，防止影响性能甚至造成系统崩溃。
        @ 一定要小于物理内存(512MB)，留有充足的内存供系统及其他应用程序使用。

 

  五. 备份策略： 
   1. 使用快照：snapshot


        save 60 1000  

        [说明]
        @ 如上的设置，会在60s内、如果有1000个key发生改变就进行持久化。
        @ 可设置多个save选项，默认持久化到dump.rdb。
  2. 文件追加(aof)：append-only-file模式。
   @ Redis会将每个接收到的“写命令”通过write函数追加到appendonly.aof文件，重启Redis时通过该文件重建整个数据库。
   @ 由于os内核会缓存write函数所做的“修改”，可以使用fsync函数指定写入到磁盘的方式。


        appendonly yes                  #启动aof持久化方式  
          
        appendfsync always          #对每条“写命令”立即写至磁盘  
        appendfsync everysec        #默认：每秒写入一次，在性能和可靠性之间的平衡  
        appendfsync no                  #依赖于os，不指定写入时机  

        3. 两种方式的比较：
        @ 快照方式：性能较好，但是快照间隔期间，如果宕机将造成数据丢失。
        @ AOF模式：影响性能，不容易造成数据丢失。
        @ 如果Redis宕机：重启Redis即可，会自动使用redis.rdb、appendonly.aof恢复数据库。
   4. 主从备份：从数据安全性角度考虑。
        @ 关闭快照功能。
        @ 同时设置主从服务器都为AOF模式。
        @ 说明：如果仅对Slave进行持久化设置，重启时，Slave自动和Master进行同步，全部数据丢失惊讶。